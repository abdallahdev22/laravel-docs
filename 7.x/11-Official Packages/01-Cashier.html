<!DOCTYPE html>
<html class="gr__laravel_com" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Laravel Cashier - Laravel - The PHP Framework For Web Artisans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <link rel="canonical" href="https://laravel.com/docs/7.x/billing">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://laravel.com/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://laravel.com/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://laravel.com/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://laravel.com/img/favicon/site.webmanifest">
    <link rel="mask-icon" href="https://laravel.com/img/favicon/safari-pinned-tab.svg" color="#ff2d20">
    <link rel="shortcut icon" href="https://laravel.com/img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#ff2d20">
    <meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Load fonts -->
    <link rel="stylesheet" href="01-Cashier_files/ins2wgm.css">

    <!-- Load styles -->
    <link rel="stylesheet" type="text/css" href="01-Cashier_files/app.css">

    <!-- Load JS -->
    <script src="01-Cashier_files/jquery.js"></script>

    <script id="_carbonads_projs" type="text/javascript" src="01-Cashier_files/CKYILK3E.json"></script>
</head>
<body class="language-php" data-gr-c-s-loaded="true">

<div class="sidebar_layout" id="docsScreen">

    <div class="page_contain">
        <div class="contain">
            <aside class="sidebar">
                <a href="../index.html" class="logo">
                    <img class="mark" src="../index_files/logomark.min.svg" alt="Laravel">
                    <img class="type" src="../index_files/logotype.min.svg" alt="Laravel">
                </a>
                <nav>
                    <div class="navigation_contain" style="display: block;">
                        <div class="docs_sidebar">
                            <ul>
                                <li>
                                    <h2>Prologue</h2>
                                    <ul>
                                        <li><a href="../01-Prologue/01-Release%20Notes.html">Release Notes</a></li>
                                        <li><a href="../01-Prologue/02-Upgrade%20Guide.html">Upgrade Guide</a></li>
                                        <li><a href="../01-Prologue/03-Contribution%20Guide.html">Contribution Guide</a>
                                        </li>
                                        <li><a href="https://laravel.com/api/7.x">API Documentation</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Getting Started</h2>
                                    <ul>
                                        <li><a href="../02-Getting%20Started/01-Installation.html">Installation</a></li>
                                        <li><a href="../02-Getting%20Started/02-Configuration.html">Configuration</a>
                                        </li>
                                        <li><a href="../02-Getting%20Started/03-Directory%20Structure.html">Directory
                                            Structure</a>
                                        </li>
                                        <li><a href="../02-Getting%20Started/04-Homestead.html">Homestead</a></li>
                                        <li><a href="../02-Getting%20Started/05-Valet.html">Valet</a></li>
                                        <li><a href="../02-Getting%20Started/06-Deployment.html">Deployment</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Architecture Concepts</h2>
                                    <ul>
                                        <li><a href="../03-Architecture%20Concepts/01-Request%20Lifecycle.html">Request
                                            Lifecycle</a></li>
                                        <li><a href="../03-Architecture%20Concepts/02-Service%20Container.html">Service
                                            Container</a></li>
                                        <li><a href="../03-Architecture%20Concepts/03-Service%20Providers.html">Service
                                            Providers</a></li>
                                        <li><a href="../03-Architecture%20Concepts/04-Facades.html">Facades</a></li>
                                        <li><a href="../03-Architecture%20Concepts/05-Contracts.html">Contracts</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>The Basics</h2>
                                    <ul>
                                        <li><a href="../04-The%20Basics/01-Routing.html">Routing</a></li>
                                        <li><a href="../04-The%20Basics/02-Middleware.html">Middleware</a></li>
                                        <li><a href="../04-The%20Basics/03-CSRF%20Protection.html">CSRF Protection</a>
                                        </li>
                                        <li><a href="../04-The%20Basics/04-Controllers.html">Controllers</a></li>
                                        <li><a href="../04-The%20Basics/05-Requests.html">Requests</a></li>
                                        <li><a href="../04-The%20Basics/06-Responses.html">Responses</a></li>
                                        <li><a href="../04-The%20Basics/07-Views.html">Views</a></li>
                                        <li><a href="../04-The%20Basics/08-URL%20Generation.html">URL Generation</a>
                                        </li>
                                        <li><a href="../04-The%20Basics/09-Session.html">Session</a></li>
                                        <li><a href="../04-The%20Basics/10-Validation.html">Validation</a></li>
                                        <li><a href="../04-The%20Basics/11-Error%20Handling.html">Error Handling</a>
                                        </li>
                                        <li><a href="../04-The%20Basics/12-Logging.html">Logging</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Frontend</h2>
                                    <ul>
                                        <li><a href="../05-Frontend/01-Blade%20Templates.html">Blade Templates</a></li>
                                        <li><a href="../05-Frontend/02-Localization.html">Localization</a></li>
                                        <li><a href="../05-Frontend/03-Frontend%20Scaffolding.html">Frontend
                                            Scaffolding</a></li>
                                        <li><a href="../05-Frontend/04-Compiling%20Assets.html">Compiling Assets</a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Security</h2>
                                    <ul>
                                        <li><a href="../06-Security/01-Authentication.html">Authentication</a></li>
                                        <li><a href="../06-Security/02-Authorization.html">Authorization</a></li>
                                        <li><a href="../06-Security/03-Email%20Verification.html">Email Verification</a>
                                        </li>
                                        <li><a href="../06-Security/04-Encryption.html">Encryption</a></li>
                                        <li><a href="../06-Security/05-Hashing.html">Hashing</a></li>
                                        <li><a href="../06-Security/06-Password%20Reset.html">Password Reset</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Digging Deeper</h2>
                                    <ul>
                                        <li><a href="../07-Digging%20Deeper/01-Artisan%20Console.html">Artisan
                                            Console</a></li>
                                        <li><a href="../07-Digging%20Deeper/02-Broadcasting.html">Broadcasting</a></li>
                                        <li><a href="../07-Digging%20Deeper/03-Cache.html">Cache</a></li>
                                        <li><a href="../07-Digging%20Deeper/04-Collections.html">Collections</a></li>
                                        <li><a href="../07-Digging%20Deeper/05-Events.html">Events</a></li>
                                        <li><a href="../07-Digging%20Deeper/06-File%20Storage.html">File Storage</a>
                                        </li>
                                        <li><a href="../07-Digging%20Deeper/07-Helpers.html">Helpers</a></li>
                                        <li><a href="../07-Digging%20Deeper/08-HTTP%20Client.html">HTTP Client</a></li>
                                        <li><a href="../07-Digging%20Deeper/09-Mail.html">Mail</a></li>
                                        <li><a href="../07-Digging%20Deeper/10-Notifications.html">Notifications</a>
                                        </li>
                                        <li><a href="../07-Digging%20Deeper/11-Package%20Development.html">Package
                                            Development</a>
                                        </li>
                                        <li><a href="../07-Digging%20Deeper/12-Queues.html">Queues</a></li>
                                        <li><a href="../07-Digging%20Deeper/13-Task%20Scheduling.html">Task
                                            Scheduling</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Database</h2>
                                    <ul>
                                        <li><a href="../08-Database/01-Getting%20Started.html">Getting Started</a></li>
                                        <li><a href="../08-Database/02-Query%20Builder.html">Query Builder</a></li>
                                        <li><a href="../08-Database/03-Pagination.html">Pagination</a></li>
                                        <li><a href="../08-Database/04-Migrations.html">Migrations</a></li>
                                        <li><a href="../08-Database/05-Seeding.html">Seeding</a></li>
                                        <li><a href="../08-Database/06-Redis.html">Redis</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Eloquent ORM</h2>
                                    <ul>
                                        <li><a href="../09-Eloquent%20ORM/01-Getting%20Started.html">Getting Started</a>
                                        </li>
                                        <li><a href="../09-Eloquent%20ORM/02-Relationships.html">Relationships</a></li>
                                        <li><a href="../09-Eloquent%20ORM/03-Collections.html">Collections</a></li>
                                        <li><a href="../09-Eloquent%20ORM/04-Mutators.html">Mutators</a></li>
                                        <li><a href="../09-Eloquent%20ORM/05-API%20Resources.html">API Resources</a>
                                        </li>
                                        <li><a href="../09-Eloquent%20ORM/06-Serialization.html">Serialization</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Testing</h2>
                                    <ul>
                                        <li><a href="../10-Testing/01-Getting%20Started.html">Getting Started</a></li>
                                        <li><a href="../10-Testing/02-HTTP%20Tests.html">HTTP Tests</a></li>
                                        <li><a href="../10-Testing/03-Console%20Tests.html">Console Tests</a></li>
                                        <li><a href="../10-Testing/04-Browser%20Tests.html">Browser Tests</a></li>
                                        <li><a href="../10-Testing/05-Database.html">Database</a></li>
                                        <li><a href="../10-Testing/06-Mocking.html">Mocking</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Official Packages</h2>
                                    <ul>
                                        <li><a href="../11-Official%20Packages/01-Cashier.html">Cashier (Stripe)</a>
                                        </li>
                                        <li><a href="https://github.com/laravel/cashier-mollie">Cashier (Mollie)</a>
                                        </li>
                                        <li><a href="../11-Official%20Packages/02-Dusk.html">Dusk</a></li>
                                        <li><a href="../11-Official%20Packages/03-Envoy.html">Envoy</a></li>
                                        <li><a href="../11-Official%20Packages/04-Horizon.html">Horizon</a></li>
                                        <li><a href="../11-Official%20Packages/05-Passport.html">Passport</a></li>
                                        <li><a href="../11-Official%20Packages/06-Sanctum.html">Sanctum</a></li>
                                        <li><a href="../11-Official%20Packages/07-Scout.html">Scout</a></li>
                                        <li><a href="../11-Official%20Packages/08-Socialite.html">Socialite</a></li>
                                        <li><a href="../11-Official%20Packages/09-Telescope.html">Telescope</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
                <div class="trigger_contain">
                    <a href="#" class="nav_trigger" aria-label="Menu">
                        <div class="bar"></div>
                    </a>
                </div>
            </aside>

            <section class="body_content">
                <section class="docs_body">
                    <section class="docs_main">
                        <h1>Laravel Cashier</h1>
                        <ul>
                            <li><a href="#introduction">Introduction</a></li>
                            <li><a href="#upgrading-cashier">Upgrading Cashier</a></li>
                            <li><a href="#installation">Installation</a></li>
                            <li><a href="#configuration">Configuration</a>
                                <ul>
                                    <li><a href="#billable-model">Billable Model</a></li>
                                    <li><a href="#api-keys">API Keys</a></li>
                                    <li><a href="#currency-configuration">Currency Configuration</a></li>
                                    <li><a href="#logging">Logging</a></li>
                                </ul>
                            </li>
                            <li><a href="#customers">Customers</a>
                                <ul>
                                    <li><a href="#retrieving-customers">Retrieving Customers</a></li>
                                    <li><a href="#creating-customers">Creating Customers</a></li>
                                    <li><a href="#updating-customers">Updating Customers</a></li>
                                </ul>
                            </li>
                            <li><a href="#payment-methods">Payment Methods</a>
                                <ul>
                                    <li><a href="#storing-payment-methods">Storing Payment Methods</a></li>
                                    <li><a href="#retrieving-payment-methods">Retrieving Payment Methods</a></li>
                                    <li><a href="#check-for-a-payment-method">Determining If A User Has A Payment
                                        Method</a></li>
                                    <li><a href="#updating-the-default-payment-method">Updating The Default Payment
                                        Method</a></li>
                                    <li><a href="#adding-payment-methods">Adding Payment Methods</a></li>
                                    <li><a href="#deleting-payment-methods">Deleting Payment Methods</a></li>
                                </ul>
                            </li>
                            <li><a href="#subscriptions">Subscriptions</a>
                                <ul>
                                    <li><a href="#creating-subscriptions">Creating Subscriptions</a></li>
                                    <li><a href="#checking-subscription-status">Checking Subscription Status</a></li>
                                    <li><a href="#changing-plans">Changing Plans</a></li>
                                    <li><a href="#subscription-quantity">Subscription Quantity</a></li>
                                    <li><a href="#multiplan-subscriptions">Multiplan Subscriptions</a></li>
                                    <li><a href="#subscription-taxes">Subscription Taxes</a></li>
                                    <li><a href="#subscription-anchor-date">Subscription Anchor Date</a></li>
                                    <li><a href="#cancelling-subscriptions">Cancelling Subscriptions</a></li>
                                    <li><a href="#resuming-subscriptions">Resuming Subscriptions</a></li>
                                </ul>
                            </li>
                            <li><a href="#subscription-trials">Subscription Trials</a>
                                <ul>
                                    <li><a href="#with-payment-method-up-front">With Payment Method Up Front</a></li>
                                    <li><a href="#without-payment-method-up-front">Without Payment Method Up Front</a>
                                    </li>
                                    <li><a href="#extending-trials">Extending Trials</a></li>
                                </ul>
                            </li>
                            <li><a href="#handling-stripe-webhooks">Handling Stripe Webhooks</a>
                                <ul>
                                    <li><a href="#defining-webhook-event-handlers">Defining Webhook Event Handlers</a>
                                    </li>
                                    <li><a href="#handling-failed-subscriptions">Failed Subscriptions</a></li>
                                    <li><a href="#verifying-webhook-signatures">Verifying Webhook Signatures</a></li>
                                </ul>
                            </li>
                            <li><a href="#single-charges">Single Charges</a>
                                <ul>
                                    <li><a href="#simple-charge">Simple Charge</a></li>
                                    <li><a href="#charge-with-invoice">Charge With Invoice</a></li>
                                    <li><a href="#refunding-charges">Refunding Charges</a></li>
                                </ul>
                            </li>
                            <li><a href="#invoices">Invoices</a>
                                <ul>
                                    <li><a href="#generating-invoice-pdfs">Generating Invoice PDFs</a></li>
                                </ul>
                            </li>
                            <li><a href="#handling-failed-payments">Handling Failed Payments</a></li>
                            <li><a href="#strong-customer-authentication">Strong Customer Authentication (SCA)</a>
                                <ul>
                                    <li><a href="#payments-requiring-additional-confirmation">Payments Requiring
                                        Additional Confirmation</a></li>
                                    <li><a href="#off-session-payment-notifications">Off-session Payment
                                        Notifications</a></li>
                                </ul>
                            </li>
                            <li><a href="#stripe-sdk">Stripe SDK</a></li>
                            <li><a href="#testing">Testing</a></li>
                        </ul>
                        <p><a name="introduction"></a></p>
                        <h2 id="introduction"><a href="#introduction">Introduction</a></h2>
                        <p>Laravel Cashier provides an expressive, fluent interface to <a href="https://stripe.com/">Stripe's</a>
                            subscription billing services. It handles almost all of the boilerplate
                            subscription billing code you are dreading writing. In addition to
                            basic subscription management, Cashier can handle coupons, swapping
                            subscription, subscription "quantities", cancellation grace periods, and
                            even generate invoice PDFs.</p>
                        <p><a name="upgrading-cashier"></a></p>
                        <h2 id="upgrading-cashier"><a href="#upgrading-cashier">Upgrading Cashier</a></h2>
                        <p>When upgrading to a new version of Cashier, it's important that you carefully review <a
                                href="https://github.com/laravel/cashier/blob/master/UPGRADE.md">the upgrade guide</a>.
                        </p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> To prevent breaking changes, Cashier uses a fixed Stripe API
                                    version. Cashier 11 utilizes Stripe API version <code class=" language-php"><span
                                            class="token number">2020</span><span class="token operator">-</span><span
                                            class="token number">03</span><span class="token operator">-</span><span
                                            class="token number">02</span></code>. The Stripe API version will be
                                    updated on minor releases in order to make use of new Stripe features and
                                    improvements.</p></div>
                        </blockquote>
                        <p><a name="installation"></a></p>
                        <h2 id="installation"><a href="#installation">Installation</a></h2>
                        <p>First, require the Cashier package for Stripe with Composer:</p>
                        <pre class=" language-php"><code class=" language-php">composer <span class="token keyword">require</span> laravel<span
                                class="token operator">/</span>cashier</code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> To ensure Cashier properly handles all Stripe events, remember to <a
                                        href="#handling-stripe-webhooks">set up Cashier's webhook handling</a>.</p>
                            </div>
                        </blockquote>
                        <h4>Database Migrations</h4>
                        <p>The Cashier service provider registers its own database migration
                            directory, so remember to migrate your database after installing the
                            package. The Cashier migrations will add several columns to your <code
                                    class=" language-php">users</code> table as well as create a new <code
                                    class=" language-php">subscriptions</code> table to hold all of your customer's
                            subscriptions:</p>
                        <pre class=" language-php"><code class=" language-php">php artisan migrate</code></pre>
                        <p>If you need to overwrite the migrations that ship with the Cashier package, you can publish
                            them using the <code class=" language-php">vendor<span class="token punctuation">:</span>publish</code>
                            Artisan command:</p>
                        <pre class=" language-php"><code class=" language-php">php artisan vendor<span
                                class="token punctuation">:</span>publish <span class="token operator">--</span>tag<span
                                class="token operator">=</span><span class="token double-quoted-string string">"cashier-migrations"</span></code></pre>
                        <p>If you would like to prevent Cashier's migrations from running entirely, you may use the
                            <code class=" language-php">ignoreMigrations</code> provided by Cashier. Typically, this
                            method should be called in the <code class=" language-php">register</code> method of your
                            <code class=" language-php">AppServiceProvider</code>:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">Laravel<span
                                class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Cashier</span><span
                                class="token punctuation">;</span>

Cashier<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ignoreMigrations</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content">
                                    Stripe recommends that any column used for storing Stripe identifiers
                                    should be case-sensitive. Therefore, you should ensure the column
                                    collation for the <code class=" language-php">stripe_id</code> column is set to, for
                                    example, <code class=" language-php">utf8_bin</code> in MySQL. More info can be
                                    found <a
                                        href="https://stripe.com/docs/upgrades#what-changes-does-stripe-consider-to-be-backwards-compatible">in
                                    the Stripe documentation</a>.</p></div>
                        </blockquote>
                        <p><a name="configuration"></a></p>
                        <h2 id="configuration"><a href="#configuration">Configuration</a></h2>
                        <p><a name="billable-model"></a></p>
                        <h3 id="billable-model"><a href="#billable-model">Billable Model</a></h3>
                        <p>Before using Cashier, add the <code class=" language-php">Billable</code>
                            trait to your model definition. This trait provides various methods to
                            allow you to perform common billing tasks, such as creating
                            subscriptions, applying coupons, and updating payment method
                            information:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">Laravel<span
                                class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Billable</span><span
                                class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span
                                    class="token keyword">extends</span> <span
                                    class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Billable</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
                        <p>Cashier assumes your Billable model will be the <code class=" language-php">App\<span
                                class="token package">User</span></code> class that ships with Laravel. If you wish to
                            change this you can specify a different model in your <code class=" language-php"><span
                                    class="token punctuation">.</span>env</code> file:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token constant">CASHIER_MODEL</span><span
                                class="token operator">=</span>App\<span class="token package">User</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> If you're using a model other than Laravel's supplied <code
                                        class=" language-php">App\<span class="token package">User</span></code> model,
                                    you'll need to publish and alter the <a href="#installation">migrations</a> provided
                                    to match your alternative model's table name.</p></div>
                        </blockquote>
                        <p><a name="api-keys"></a></p>
                        <h3 id="api-keys"><a href="#api-keys">API Keys</a></h3>
                        <p>Next, you should configure your Stripe key in your <code class=" language-php"><span
                                class="token punctuation">.</span>env</code> file. You can retrieve your Stripe API keys
                            from the Stripe control panel.</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token constant">STRIPE_KEY</span><span class="token operator">=</span>your<span
                                class="token operator">-</span>stripe<span class="token operator">-</span>key
<span class="token constant">STRIPE_SECRET</span><span class="token operator">=</span>your<span
                                    class="token operator">-</span>stripe<span
                                    class="token operator">-</span>secret</code></pre>
                        <p><a name="currency-configuration"></a></p>
                        <h3 id="currency-configuration"><a href="#currency-configuration">Currency Configuration</a>
                        </h3>
                        <p>The default Cashier currency is United States Dollars (USD). You can change the default
                            currency by setting the <code class=" language-php"><span class="token constant">CASHIER_CURRENCY</span></code>
                            environment variable:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token constant">CASHIER_CURRENCY</span><span
                                class="token operator">=</span>eur</code></pre>
                        <p>In addition to configuring Cashier's currency, you may also specify a
                            locale to be used when formatting money values for display on invoices.
                            Internally, Cashier utilizes <a
                                    href="https://www.php.net/manual/en/class.numberformatter.php">PHP's <code
                                    class=" language-php">NumberFormatter</code> class</a> to set the currency locale:
                        </p>
                        <pre class=" language-php"><code class=" language-php"><span class="token constant">CASHIER_CURRENCY_LOCALE</span><span
                                class="token operator">=</span>nl_BE</code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> In order to use locales other than <code
                                        class=" language-php">en</code>, ensure the <code class=" language-php">ext<span
                                        class="token operator">-</span>intl</code> PHP extension is installed and
                                    configured on your server.</p></div>
                        </blockquote>
                        <p><a name="logging"></a></p>
                        <h4 id="logging"><a href="#logging">Logging</a></h4>
                        <p>Cashier allows you to specify the log channel to be used when logging
                            all Stripe related exceptions. You may specify the log channel using
                            the <code class=" language-php"><span class="token constant">CASHIER_LOGGER</span></code>
                            environment variable:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token constant">CASHIER_LOGGER</span><span
                                class="token operator">=</span>stack</code></pre>
                        <p><a name="customers"></a></p>
                        <h2 id="customers"><a href="#customers">Customers</a></h2>
                        <p><a name="retrieving-customers"></a></p>
                        <h3 id="retrieving-customers"><a href="#retrieving-customers">Retrieving Customers</a></h3>
                        <p>You can retrieve a customer by their Stripe ID using the <code
                                class=" language-php">Cashier<span class="token punctuation">:</span><span
                                class="token punctuation">:</span>findBillable</code> method. This will return an
                            instance of the Billable model:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">Laravel<span
                                class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Cashier</span><span
                                class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> Cashier<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">findBillable</span><span
                                    class="token punctuation">(</span><span class="token variable">$stripeId</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="creating-customers"></a></p>
                        <h3 id="creating-customers"><a href="#creating-customers">Creating Customers</a></h3>
                        <p>Occasionally, you may wish to create a Stripe customer without beginning a subscription. You
                            may accomplish this using the <code class=" language-php">createAsStripeCustomer</code>
                            method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$stripeCustomer</span> <span
                                class="token operator">=</span> <span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">createAsStripeCustomer</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p>Once the customer has been created in Stripe, you may begin a subscription at a later date.
                            You can also use an optional <code class=" language-php"><span class="token variable">$options</span></code>
                            array to pass in any additional parameters which are supported by the Stripe API:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$stripeCustomer</span> <span
                                class="token operator">=</span> <span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">createAsStripeCustomer</span><span
                                class="token punctuation">(</span><span class="token variable">$options</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>You may also use the <code class=" language-php">createOrGetStripeCustomer</code> method if
                            you want to return the customer object if the billable entity is already a customer within
                            Stripe.</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$stripeCustomer</span> <span
                                class="token operator">=</span> <span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">createOrGetStripeCustomer</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p><a name="updating-customers"></a></p>
                        <h3 id="updating-customers"><a href="#updating-customers">Updating Customers</a></h3>
                        <p>Occasionally, you may wish to update the Stripe customer directly
                            with additional information. You may accomplish this using the <code class=" language-php">updateStripeCustomer</code>
                            method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$stripeCustomer</span> <span
                                class="token operator">=</span> <span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">updateStripeCustomer</span><span
                                class="token punctuation">(</span><span class="token variable">$options</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p><a name="payment-methods"></a></p>
                        <h2 id="payment-methods"><a href="#payment-methods">Payment Methods</a></h2>
                        <p><a name="storing-payment-methods"></a></p>
                        <h3 id="storing-payment-methods"><a href="#storing-payment-methods">Storing Payment Methods</a>
                        </h3>
                        <p>In order to create subscriptions or perform "one off" charges with
                            Stripe, you will need to store a payment method and retrieve its
                            identifier from Stripe. The approach used to accomplish differs based on
                            whether you plan to use the payment method for subscriptions or single
                            charges, so we will examine both below.</p>
                        <h4>Payment Methods For Subscriptions</h4>
                        <p>When storing credit cards to a customer for future use, the Stripe
                            Setup Intents API must be used to securely gather the customer's payment
                            method details. A "Setup Intent" indicates to Stripe the intention to
                            charge a customer's payment method. Cashier's <code class=" language-php">Billable</code>
                            trait includes the <code class=" language-php">createSetupIntent</code>
                            to easily create a new Setup Intent. You should call this method from
                            the route or controller that will render the form which gathers your
                            customer's payment method details:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token keyword">return</span> <span
                                class="token function">view</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'update-payment-method'</span><span
                                class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'intent'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token variable">$user</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">createSetupIntent</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>After you have created the Setup Intent and passed it to the view,
                            you should attach its secret to the element that will gather the payment
                            method. For example, consider this "update payment method" form:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token operator">&lt;</span>input id<span
                                class="token operator">=</span><span class="token double-quoted-string string">"card-holder-name"</span> type<span
                                class="token operator">=</span><span
                                class="token double-quoted-string string">"text"</span><span
                                class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Stripe Elements Placeholder <span
                                    class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span
                                    class="token double-quoted-string string">"card-element"</span><span
                                    class="token operator">&gt;</span><span class="token operator">&lt;</span><span
                                    class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span
                                    class="token double-quoted-string string">"card-button"</span> data<span
                                    class="token operator">-</span>secret<span class="token operator">=</span><span
                                    class="token double-quoted-string string">"{{ <span
                                    class="token interpolation"><span class="token variable">$intent</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">client_secret</span></span> }}"</span><span
                                    class="token operator">&gt;</span>
    Update Payment Method
<span class="token operator">&lt;</span><span class="token operator">/</span>button<span
                                    class="token operator">&gt;</span></code></pre>
                        <p>Next, the Stripe.js library may be used to attach a Stripe Element to
                            the form and securely gather the customer's payment details:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token operator">&lt;</span>script src<span
                                class="token operator">=</span><span class="token double-quoted-string string">"https://js.stripe.com/v3/"</span><span
                                class="token operator">&gt;</span><span class="token operator">&lt;</span><span
                                class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">const</span> stripe <span class="token operator">=</span> <span class="token function">Stripe</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'stripe-public-key'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> elements <span class="token operator">=</span> stripe<span
                                    class="token punctuation">.</span><span class="token function">elements</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
    <span class="token keyword">const</span> cardElement <span class="token operator">=</span> elements<span
                                    class="token punctuation">.</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'card'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

    cardElement<span class="token punctuation">.</span><span class="token function">mount</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'#card-element'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span
                                    class="token operator">&gt;</span></code></pre>
                        <p>Next, the card can be verified and a secure "payment method identifier" can be retrieved from
                            Stripe using <a href="https://stripe.com/docs/js/setup_intents/confirm_card_setup">Stripe's
                                <code class=" language-php">confirmCardSetup</code> method</a>:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token keyword">const</span> cardHolderName <span
                                class="token operator">=</span> document<span class="token punctuation">.</span><span
                                class="token function">getElementById</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'card-holder-name'</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cardButton <span class="token operator">=</span> document<span
                                    class="token punctuation">.</span><span class="token function">getElementById</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'card-button'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> clientSecret <span class="token operator">=</span> cardButton<span
                                    class="token punctuation">.</span>dataset<span class="token punctuation">.</span>secret<span
                                    class="token punctuation">;</span>

cardButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'click'</span><span
                                    class="token punctuation">,</span> async <span
                                    class="token punctuation">(</span>e<span class="token punctuation">)</span> <span
                                    class="token operator">=</span><span class="token operator">&gt;</span> <span
                                    class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> setupIntent<span
                                    class="token punctuation">,</span> error <span
                                    class="token punctuation">}</span> <span class="token operator">=</span> await stripe<span
                                    class="token punctuation">.</span><span
                                    class="token function">confirmCardSetup</span><span
                                    class="token punctuation">(</span>
        clientSecret<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            payment_method<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                card<span class="token punctuation">:</span> cardElement<span class="token punctuation">,</span>
                billing_details<span class="token punctuation">:</span> <span
                                    class="token punctuation">{</span> name<span class="token punctuation">:</span> cardHolderName<span
                                    class="token punctuation">.</span>value <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Display "error.message" to the user...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span
                                    class="token punctuation">{</span>
        <span class="token comment">// The card has been verified successfully...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>After the card has been verified by Stripe, you may pass the resulting <code
                                class=" language-php">setupIntent<span class="token punctuation">.</span>payment_method</code>
                            identifier to your Laravel application, where it can be attached to the customer. The
                            payment method can either be <a href="#adding-payment-methods">added as a new payment
                                method</a> or <a href="#updating-the-default-payment-method">used to update the default
                                payment method</a>. You can also immediately use the payment method identifier to <a
                                    href="#creating-subscriptions">create a new subscription</a>.</p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon purple"><img src="01-Cashier_files/lightbulb.svg"></div>
                                <p class="content"> If you would like more information about Setup Intents and gathering
                                    customer payment details please <a
                                            href="https://stripe.com/docs/payments/save-and-reuse#php">review this
                                        overview provided by Stripe</a>.</p></div>
                        </blockquote>
                        <h4>Payment Methods For Single Charges</h4>
                        <p>Of course, when making a single charge against a customer's payment
                            method we'll only need to use a payment method identifier a single time.
                            Due to Stripe limitations, you may not use the stored default payment
                            method of a customer for single charges. You must allow the customer to
                            enter their payment method details using the Stripe.js library. For
                            example, consider the following form:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token operator">&lt;</span>input id<span
                                class="token operator">=</span><span class="token double-quoted-string string">"card-holder-name"</span> type<span
                                class="token operator">=</span><span
                                class="token double-quoted-string string">"text"</span><span
                                class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Stripe Elements Placeholder <span
                                    class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span
                                    class="token double-quoted-string string">"card-element"</span><span
                                    class="token operator">&gt;</span><span class="token operator">&lt;</span><span
                                    class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span
                                    class="token double-quoted-string string">"card-button"</span><span
                                    class="token operator">&gt;</span>
    Process Payment
<span class="token operator">&lt;</span><span class="token operator">/</span>button<span
                                    class="token operator">&gt;</span></code></pre>
                        <p>Next, the Stripe.js library may be used to attach a Stripe Element to
                            the form and securely gather the customer's payment details:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token operator">&lt;</span>script src<span
                                class="token operator">=</span><span class="token double-quoted-string string">"https://js.stripe.com/v3/"</span><span
                                class="token operator">&gt;</span><span class="token operator">&lt;</span><span
                                class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">const</span> stripe <span class="token operator">=</span> <span class="token function">Stripe</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'stripe-public-key'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> elements <span class="token operator">=</span> stripe<span
                                    class="token punctuation">.</span><span class="token function">elements</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
    <span class="token keyword">const</span> cardElement <span class="token operator">=</span> elements<span
                                    class="token punctuation">.</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'card'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

    cardElement<span class="token punctuation">.</span><span class="token function">mount</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'#card-element'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span
                                    class="token operator">&gt;</span></code></pre>
                        <p>Next, the card can be verified and a secure "payment method identifier" can be retrieved from
                            Stripe using <a
                                    href="https://stripe.com/docs/stripe-js/reference#stripe-create-payment-method">Stripe's
                                <code class=" language-php">createPaymentMethod</code> method</a>:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token keyword">const</span> cardHolderName <span
                                class="token operator">=</span> document<span class="token punctuation">.</span><span
                                class="token function">getElementById</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'card-holder-name'</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cardButton <span class="token operator">=</span> document<span
                                    class="token punctuation">.</span><span class="token function">getElementById</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'card-button'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

cardButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'click'</span><span
                                    class="token punctuation">,</span> async <span
                                    class="token punctuation">(</span>e<span class="token punctuation">)</span> <span
                                    class="token operator">=</span><span class="token operator">&gt;</span> <span
                                    class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> paymentMethod<span
                                    class="token punctuation">,</span> error <span
                                    class="token punctuation">}</span> <span class="token operator">=</span> await stripe<span
                                    class="token punctuation">.</span><span
                                    class="token function">createPaymentMethod</span><span
                                    class="token punctuation">(</span>
        <span class="token single-quoted-string string">'card'</span><span class="token punctuation">,</span> cardElement<span
                                    class="token punctuation">,</span> <span class="token punctuation">{</span>
            billing_details<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span
                                    class="token punctuation">:</span> cardHolderName<span
                                    class="token punctuation">.</span>value <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Display "error.message" to the user...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span
                                    class="token punctuation">{</span>
        <span class="token comment">// The card has been verified successfully...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>If the card is verified successfully, you may pass the <code class=" language-php">paymentMethod<span
                                class="token punctuation">.</span>id</code> to your Laravel application and process a <a
                                href="#simple-charge">single charge</a>.</p>
                        <p><a name="retrieving-payment-methods"></a></p>
                        <h3 id="retrieving-payment-methods"><a href="#retrieving-payment-methods">Retrieving Payment
                            Methods</a></h3>
                        <p>The <code class=" language-php">paymentMethods</code> method on the Billable model instance
                            returns a collection of <code class=" language-php">Laravel\<span class="token package">Cashier<span
                                    class="token punctuation">\</span>PaymentMethod</span></code> instances:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$paymentMethods</span> <span
                                class="token operator">=</span> <span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">paymentMethods</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p>To retrieve the default payment method, the <code
                                class=" language-php">defaultPaymentMethod</code> method may be used:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$paymentMethod</span> <span
                                class="token operator">=</span> <span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">defaultPaymentMethod</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p>You can also retrieve a specific payment method that is owned by the Billable model using the
                            <code class=" language-php">findPaymentMethod</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$paymentMethod</span> <span
                                class="token operator">=</span> <span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">findPaymentMethod</span><span
                                class="token punctuation">(</span><span
                                class="token variable">$paymentMethodId</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p><a name="check-for-a-payment-method"></a></p>
                        <h3 id="check-for-a-payment-method"><a href="#check-for-a-payment-method">Determining If A User
                            Has A Payment Method</a></h3>
                        <p>To determine if a Billable model has a default payment method attached to their account, use
                            the <code class=" language-php">hasDefaultPaymentMethod</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">hasDefaultPaymentMethod</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>To determine if a Billable model has at least one payment method attached to their account,
                            use the <code class=" language-php">hasPaymentMethod</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">hasPaymentMethod</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p><a name="updating-the-default-payment-method"></a></p>
                        <h3 id="updating-the-default-payment-method"><a href="#updating-the-default-payment-method">Updating
                            The Default Payment Method</a></h3>
                        <p>The <code class=" language-php">updateDefaultPaymentMethod</code>
                            method may be used to update a customer's default payment method
                            information. This method accepts a Stripe payment method identifier and
                            will assign the new payment method as the default billing payment
                            method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">updateDefaultPaymentMethod</span><span class="token punctuation">(</span><span
                                class="token variable">$paymentMethod</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>To sync your default payment method information with the customer's
                            default payment method information in Stripe, you may use the <code class=" language-php">updateDefaultPaymentMethodFromStripe</code>
                            method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">updateDefaultPaymentMethodFromStripe</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content">
                                    The default payment method on a customer can only be used for invoicing
                                    and creating new subscriptions. Due to limitations from Stripe, it may
                                    not be used for single charges.</p></div>
                        </blockquote>
                        <p><a name="adding-payment-methods"></a></p>
                        <h3 id="adding-payment-methods"><a href="#adding-payment-methods">Adding Payment Methods</a>
                        </h3>
                        <p>To add a new payment method, you may call the <code
                                class=" language-php">addPaymentMethod</code> method on the billable user, passing the
                            payment method identifier:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">addPaymentMethod</span><span
                                class="token punctuation">(</span><span
                                class="token variable">$paymentMethod</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon purple"><img src="01-Cashier_files/lightbulb.svg"></div>
                                <p class="content"> To learn how to retrieve payment method identifiers please review
                                    the <a href="#storing-payment-methods">payment method storage documentation</a>.</p>
                            </div>
                        </blockquote>
                        <p><a name="deleting-payment-methods"></a></p>
                        <h3 id="deleting-payment-methods"><a href="#deleting-payment-methods">Deleting Payment
                            Methods</a></h3>
                        <p>To delete a payment method, you may call the <code class=" language-php">delete</code> method
                            on the <code class=" language-php">Laravel\<span class="token package">Cashier<span
                                    class="token punctuation">\</span>PaymentMethod</span></code> instance you wish to
                            delete:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$paymentMethod</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">delete</span><span class="token punctuation">(</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>The <code class=" language-php">deletePaymentMethods</code> method will delete all of the
                            payment method information for the Billable model:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">deletePaymentMethods</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> If a user has an active subscription, you should prevent them from
                                    deleting their default payment method.</p></div>
                        </blockquote>
                        <p><a name="subscriptions"></a></p>
                        <h2 id="subscriptions"><a href="#subscriptions">Subscriptions</a></h2>
                        <p><a name="creating-subscriptions"></a></p>
                        <h3 id="creating-subscriptions"><a href="#creating-subscriptions">Creating Subscriptions</a>
                        </h3>
                        <p>To create a subscription, first retrieve an instance of your billable model, which typically
                            will be an instance of <code class=" language-php">App\<span
                                    class="token package">User</span></code>. Once you have retrieved the model
                            instance, you may use the <code class=" language-php">newSubscription</code> method to
                            create the model's subscription:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">newSubscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'premium'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token variable">$paymentMethod</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>The first argument passed to the <code class=" language-php">newSubscription</code> method
                            should be the name of the subscription. If your application only offers a single
                            subscription, you might call this <code class=" language-php"><span class="token keyword">default</span></code>
                            or <code class=" language-php">primary</code>.
                            The second argument is the specific plan the user is subscribing to.
                            This value should correspond to the plan's identifier in Stripe.</p>
                        <p>The <code class=" language-php">create</code> method, which accepts <a
                                href="#storing-payment-methods">a Stripe payment method identifier</a> or Stripe <code
                                class=" language-php">PaymentMethod</code>
                            object, will begin the subscription as well as update your database
                            with the customer ID and other relevant billing information.</p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> Passing a payment method identifier directly to the <code
                                        class=" language-php"><span class="token function">create</span><span
                                        class="token punctuation">(</span><span
                                        class="token punctuation">)</span></code> subscription method will also
                                    automatically add it to the user's stored payment methods.</p></div>
                        </blockquote>
                        <h4>Additional Details</h4>
                        <p>If you would like to specify additional customer or subscription
                            details, you may do so by passing them as the second and third arguments
                            to the <code class=" language-php">create</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">newSubscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">,</span> <span class="token single-quoted-string string">'monthly'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">create</span><span
                                class="token punctuation">(</span><span
                                class="token variable">$paymentMethod</span><span
                                class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token variable">$email</span><span
                                    class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span
                                    class="token punctuation">[</span>
    <span class="token single-quoted-string string">'metadata'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token punctuation">[</span><span
                                    class="token single-quoted-string string">'note'</span> <span
                                    class="token operator">=</span><span class="token operator">&gt;</span> <span
                                    class="token single-quoted-string string">'Some extra information.'</span><span
                                    class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>To learn more about the additional fields supported by Stripe, check out Stripe's
                            documentation on <a href="https://stripe.com/docs/api#create_customer">customer creation</a>
                            and <a href="https://stripe.com/docs/api/subscriptions/create">subscription creation</a>.
                        </p>
                        <h4>Coupons</h4>
                        <p>If you would like to apply a coupon when creating the subscription, you may use the <code
                                class=" language-php">withCoupon</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">newSubscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">,</span> <span class="token single-quoted-string string">'monthly'</span><span
                                class="token punctuation">)</span>
     <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withCoupon</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'code'</span><span
                                    class="token punctuation">)</span>
     <span class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">create</span><span class="token punctuation">(</span><span
                                    class="token variable">$paymentMethod</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <h4>Adding Subscriptions</h4>
                        <p>If you would like to add a subscription to a customer who already has a default payment
                            method set you can use the <code class=" language-php">add</code> method when using the
                            <code class=" language-php">newSubscription</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">newSubscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'premium'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">add</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="checking-subscription-status"></a></p>
                        <h3 id="checking-subscription-status"><a href="#checking-subscription-status">Checking
                            Subscription Status</a></h3>
                        <p>Once a user is subscribed to your application, you may easily check
                            their subscription status using a variety of convenient methods. First,
                            the <code class=" language-php">subscribed</code> method returns <code
                                    class=" language-php"><span class="token boolean constant">true</span></code> if the
                            user has an active subscription, even if the subscription is currently within its trial
                            period:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">subscribed</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token punctuation">)</span> <span
                                class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>The <code class=" language-php">subscribed</code> method also makes a great candidate for a
                            <a href="https://laravel.com/docs/7.x/middleware">route middleware</a>, allowing you to
                            filter access to routes and controllers based on the user's subscription status:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token keyword">public</span> <span
                                class="token keyword">function</span> <span class="token function">handle</span><span
                                class="token punctuation">(</span><span class="token variable">$request</span><span
                                class="token punctuation">,</span> Closure <span
                                class="token variable">$next</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span
                                    class="token variable">$request</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">user</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span> <span
                                    class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span
                                    class="token variable">$request</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">user</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">subscribed</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
        <span class="token comment">// This user is not a paying customer...</span>
        <span class="token keyword">return</span> <span class="token function">redirect</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'billing'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$next</span><span
                                    class="token punctuation">(</span><span class="token variable">$request</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
                        <p>If you would like to determine if a user is still within their trial period, you may use the
                            <code class=" language-php">onTrial</code> method. This method can be useful for displaying
                            a warning to the user that they are still on their trial period:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">subscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">onTrial</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>The <code class=" language-php">subscribedToPlan</code> method may be
                            used to determine if the user is subscribed to a given plan based on a
                            given Stripe plan ID. In this example, we will determine if the user's <code
                                    class=" language-php"><span class="token keyword">default</span></code> subscription
                            is actively subscribed to the <code class=" language-php">monthly</code> plan:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">subscribedToPlan</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'monthly'</span><span
                                class="token punctuation">,</span> <span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token punctuation">)</span> <span
                                class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>By passing an array to the <code class=" language-php">subscribedToPlan</code> method, you
                            may determine if the user's <code class=" language-php"><span
                                    class="token keyword">default</span></code> subscription is actively subscribed to
                            the <code class=" language-php">monthly</code> or the <code
                                    class=" language-php">yearly</code> plan:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">subscribedToPlan</span><span
                                class="token punctuation">(</span><span class="token punctuation">[</span><span
                                class="token single-quoted-string string">'monthly'</span><span
                                class="token punctuation">,</span> <span class="token single-quoted-string string">'yearly'</span><span
                                class="token punctuation">]</span><span class="token punctuation">,</span> <span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token punctuation">)</span> <span
                                class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>The <code class=" language-php">recurring</code> method may be used to determine if the user
                            is currently subscribed and is no longer within their trial period:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">subscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">recurring</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <h4>Cancelled Subscription Status</h4>
                        <p>To determine if the user was once an active subscriber, but has cancelled their subscription,
                            you may use the <code class=" language-php">cancelled</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">subscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">cancelled</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>You may also determine if a user has cancelled their subscription,
                            but are still on their "grace period" until the subscription fully
                            expires. For example, if a user cancels a subscription on March 5th that
                            was originally scheduled to expire on March 10th, the user is on their
                            "grace period" until March 10th. Note that the <code class=" language-php">subscribed</code>
                            method still returns <code class=" language-php"><span
                                    class="token boolean constant">true</span></code> during this time:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">subscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">onGracePeriod</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>To determine if the user has cancelled their subscription and is no longer within their
                            "grace period", you may use the <code class=" language-php">ended</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">subscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">ended</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p><a name="incomplete-and-past-due-status"></a></p>
                        <h4 id="incomplete-and-past-due-status"><a href="#incomplete-and-past-due-status">Incomplete and
                            Past Due Status</a></h4>
                        <p>If a subscription requires a secondary payment action after creation the subscription will be
                            marked as <code class=" language-php">incomplete</code>. Subscription statuses are stored in
                            the <code class=" language-php">stripe_status</code> column of Cashier's <code
                                    class=" language-php">subscriptions</code> database table.</p>
                        <p>Similarly, if a secondary payment action is required when swapping plans the subscription
                            will be marked as <code class=" language-php">past_due</code>.
                            When your subscription is in either of these states it will not be
                            active until the customer has confirmed their payment. Checking if a
                            subscription has an incomplete payment can be done using the <code class=" language-php">hasIncompletePayment</code>
                            method on the Billable model or a subscription instance:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">hasIncompletePayment</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token punctuation">)</span> <span
                                class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">hasIncompletePayment</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>When a subscription has an incomplete payment, you should direct the user to Cashier's
                            payment confirmation page, passing the <code class=" language-php">latestPayment</code>
                            identifier. You may use the <code class=" language-php">latestPayment</code> method
                            available on subscription instance to retrieve this identifier:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token operator">&lt;</span>a href<span
                                class="token operator">=</span><span class="token double-quoted-string string">"{{ route('cashier.payment', <span
                                class="token interpolation"><span class="token variable">$subscription</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token property">latestPayment</span></span>()-&gt;id) }}"</span><span
                                class="token operator">&gt;</span>
    Please confirm your payment<span class="token punctuation">.</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>a<span
                                    class="token operator">&gt;</span></code></pre>
                        <p>If you would like the subscription to still be considered active when it's in a <code
                                class=" language-php">past_due</code> state, you may use the <code
                                class=" language-php">keepPastDueSubscriptionsActive</code> method provided by Cashier.
                            Typically, this method should be called in the <code class=" language-php">register</code>
                            method of your <code class=" language-php">AppServiceProvider</code>:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">Laravel<span
                                class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Cashier</span><span
                                class="token punctuation">;</span>

<span class="token comment">/**
 * Register any application services.
 *
 * @return void
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Cashier<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">keepPastDueSubscriptionsActive</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> When a subscription is in an <code
                                        class=" language-php">incomplete</code> state it cannot be changed until the
                                    payment is confirmed. Therefore, the <code class=" language-php">swap</code> and
                                    <code class=" language-php">updateQuantity</code> methods will throw an exception
                                    when the subscription is in an <code class=" language-php">incomplete</code> state.
                                </p></div>
                        </blockquote>
                        <p><a name="changing-plans"></a></p>
                        <h3 id="changing-plans"><a href="#changing-plans">Changing Plans</a></h3>
                        <p>After a user is subscribed to your application, they may occasionally
                            want to change to a new subscription plan. To swap a user to a new
                            subscription, pass the plan's identifier to the <code class=" language-php">swap</code>
                            method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> App\<span class="token package">User</span><span
                                class="token punctuation">:</span><span class="token punctuation">:</span><span
                                class="token function">find</span><span class="token punctuation">(</span><span
                                class="token number">1</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">swap</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'provider-plan-id'</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>If the user is on trial, the trial period will be maintained. Also,
                            if a "quantity" exists for the subscription, that quantity will also be
                            maintained.</p>
                        <p>If you would like to swap plans and cancel any trial period the user is currently on, you may
                            use the <code class=" language-php">skipTrial</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">skipTrial</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">swap</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'provider-plan-id'</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>If you would like to swap plans and immediately invoice the user
                            instead of waiting for their next billing cycle, you may use the <code
                                    class=" language-php">swapAndInvoice</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> App\<span class="token package">User</span><span
                                class="token punctuation">:</span><span class="token punctuation">:</span><span
                                class="token function">find</span><span class="token punctuation">(</span><span
                                class="token number">1</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">swapAndInvoice</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'provider-plan-id'</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> When working with multiplan subscriptions, you cannot use the <code
                                        class=" language-php">swap</code> and <code
                                        class=" language-php">swapAndInvoice</code> methods. Instead, you should use the
                                    <code class=" language-php">addPlan</code>, <code class=" language-php">addPlanAndInvoice</code>,
                                    and <code class=" language-php">removePlan</code> methods. More information about
                                    these methods may be found in the <a href="#multiplan-subscriptions">multiplan
                                        subscription documentation</a>.</p></div>
                        </blockquote>
                        <h4>Prorations</h4>
                        <p>By default, Stripe prorates charges when swapping between plans. The <code
                                class=" language-php">noProrate</code> method may be used to update the subscription's
                            without prorating the charges:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">noProrate</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">swap</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'provider-plan-id'</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>For more information on subscription proration, consult the <a
                                href="https://stripe.com/docs/billing/subscriptions/prorations">Stripe documentation</a>.
                        </p>
                        <p><a name="subscription-quantity"></a></p>
                        <h3 id="subscription-quantity"><a href="#subscription-quantity">Subscription Quantity</a></h3>
                        <p>Sometimes subscriptions are affected by "quantity". For example, your application might
                            charge $10 per month <strong>per user</strong> on an account. To easily increment or
                            decrement your subscription quantity, use the <code
                                    class=" language-php">incrementQuantity</code> and <code class=" language-php">decrementQuantity</code>
                            methods:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">incrementQuantity</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

<span class="token comment">// Add five to the subscription's current quantity...</span>
<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">incrementQuantity</span><span
                                    class="token punctuation">(</span><span class="token number">5</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">decrementQuantity</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

<span class="token comment">// Subtract five to the subscription's current quantity...</span>
<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">decrementQuantity</span><span
                                    class="token punctuation">(</span><span class="token number">5</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>Alternatively, you may set a specific quantity using the <code class=" language-php">updateQuantity</code>
                            method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">updateQuantity</span><span
                                class="token punctuation">(</span><span class="token number">10</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>The <code class=" language-php">noProrate</code> method may be used to update the
                            subscription's quantity without prorating the charges:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">noProrate</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">updateQuantity</span><span
                                class="token punctuation">(</span><span class="token number">10</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>For more information on subscription quantities, consult the <a
                                href="https://stripe.com/docs/subscriptions/quantities">Stripe documentation</a>.</p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content">
                                    Please note that when working with multiplan subscriptions, an extra
                                    "plan" parameter is required for the above quantity methods.</p></div>
                        </blockquote>
                        <p><a name="multiplan-subscriptions"></a></p>
                        <h3 id="multiplan-subscriptions"><a href="#multiplan-subscriptions">Multiplan Subscriptions</a>
                        </h3>
                        <p><a href="https://stripe.com/docs/billing/subscriptions/multiplan">Multiplan subscriptions</a>
                            allow you to assign multiple billing plans to a single subscription.
                            For example, imagine you are building a customer service "helpdesk"
                            application that has a base subscription of $10 per month, but offers a
                            live chat add-on plan for an additional $15 per month:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">addPlan</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'chat-plan'</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>Now the customer will have two plans on their <code class=" language-php"><span
                                class="token keyword">default</span></code>
                            subscription. The example above will add the new plan and the customer
                            will be billed for it on their next billing cycle. If you would like to
                            bill the customer immediately you may use the <code
                                    class=" language-php">addPlanAndInvoice</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">addPlanAndInvoice</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'chat-plan'</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>You may remove plans from subscriptions using the <code
                                class=" language-php">removePlan</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">removePlan</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'chat-plan'</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> You may not remove the last plan on a subscription. Instead, you may
                                    simply cancel the subscription.</p></div>
                        </blockquote>
                        <h4>Proration</h4>
                        <p>By default, Stripe will prorate charges when adding or removing plans
                            from a subscription. If you would like to make a plan adjustment
                            without proration, you should chain the <code class=" language-php">noProrate</code> method
                            onto your plan operation:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">noProrate</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">removePlan</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'chat-plan'</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <h4>Quantities</h4>
                        <p>If you would like to update quantities on individual subscription plans, you may do so using
                            the <a href="https://laravel.com/docs/7.x/subscription-quantity">existing quantity
                                methods</a> and passing the name of the plan as an additional argument to the method:
                        </p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">incrementQuantity</span><span
                                    class="token punctuation">(</span><span class="token number">5</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'chat-plan'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">decrementQuantity</span><span
                                    class="token punctuation">(</span><span class="token number">3</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'chat-plan'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">updateQuantity</span><span
                                    class="token punctuation">(</span><span class="token number">10</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'chat-plan'</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> When you have multiple plans set on a subscription the <code
                                        class=" language-php">stripe_plan</code> and <code class=" language-php">quantity</code>
                                    attributes on the <code class=" language-php">Subscription</code> model will be
                                    <code class=" language-php"><span class="token constant">null</span></code>. To
                                    access the individual plans, you should use the <code
                                            class=" language-php">items</code> relationship available on the <code
                                            class=" language-php">Subscription</code> model.</p></div>
                        </blockquote>
                        <h4>Subscription Items</h4>
                        <p>When a subscription has multiple plans, it will have multiple subscription "items" stored in
                            your database's <code class=" language-php">subscription_items</code> table. You may access
                            these via the <code class=" language-php">items</code> relationship on the subscription:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$subscriptionItem</span> <span class="token operator">=</span> <span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">items</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">first</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Retrieve the Stripe plan and quantity for a specific item...</span>
<span class="token variable">$stripePlan</span> <span class="token operator">=</span> <span class="token variable">$subscriptionItem</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">stripe_plan</span><span class="token punctuation">;</span>
<span class="token variable">$quantity</span> <span class="token operator">=</span> <span class="token variable">$subscriptionItem</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">quantity</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>You can also retrieve a specific plan using the <code
                                class=" language-php">findItemOrFail</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$subscriptionItem</span> <span class="token operator">=</span> <span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">findItemOrFail</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'chat-plan'</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="subscription-taxes"></a></p>
                        <h3 id="subscription-taxes"><a href="#subscription-taxes">Subscription Taxes</a></h3>
                        <p>To specify the tax rates a user pays on a subscription, implement the <code
                                class=" language-php">taxRates</code> method on your billable model, and return an array
                            with the Tax Rate IDs. You can define these tax rates in <a
                                    href="https://dashboard.stripe.com/test/tax-rates">your Stripe dashboard</a>:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token keyword">public</span> <span
                                class="token keyword">function</span> <span class="token function">taxRates</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span
                                    class="token single-quoted-string string">'tax-rate-id'</span><span
                                    class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
                        <p>The <code class=" language-php">taxRates</code> method enables you to
                            apply a tax rate on a model-by-model basis, which may be helpful for a
                            user base that spans multiple countries and tax rates. If you're working
                            with multiplan subscriptions you can define different tax rates for
                            each plan by implementing a <code class=" language-php">planTaxRates</code> method on your
                            billable model:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token keyword">public</span> <span
                                class="token keyword">function</span> <span
                                class="token function">planTaxRates</span><span class="token punctuation">(</span><span
                                class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'plan-id'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token punctuation">[</span><span
                                    class="token single-quoted-string string">'tax-rate-id'</span><span
                                    class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> The <code class=" language-php">taxRates</code>
                                    method only applies to subscription charges. If you use Cashier to make
                                    "one off" charges, you will need to manually specify the tax rate at
                                    that time.</p></div>
                        </blockquote>
                        <h4>Syncing Tax Rates</h4>
                        <p>When changing the hard-coded Tax Rate IDs returned by the <code class=" language-php">taxRates</code>
                            method, the tax settings on any existing subscriptions for the user
                            will remain the same. If you wish to update the tax value for existing
                            subscriptions with the returned <code class=" language-php">taxTaxRates</code> values, you
                            should call the <code class=" language-php">syncTaxRates</code> method on the user's
                            subscription instance:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">syncTaxRates</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p>This will also sync any subscription item tax rates so make sure you also properly change the
                            <code class=" language-php">planTaxRates</code> method.</p>
                        <h4>Tax Exemption</h4>
                        <p>Cashier also offers methods to determine if the customer is tax exempt by calling the Stripe
                            API. The <code class=" language-php">isNotTaxExempt</code>, <code class=" language-php">isTaxExempt</code>,
                            and <code class=" language-php">reverseChargeApplies</code> methods are available on the
                            billable model:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">isTaxExempt</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">isNotTaxExempt</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">reverseChargeApplies</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>These methods are also available on any <code class=" language-php">Laravel\<span
                                class="token package">Cashier<span
                                class="token punctuation">\</span>Invoice</span></code> object. However, when calling
                            these methods on an <code class=" language-php">Invoice</code> object the methods will
                            determine the exemption status at the time the invoice was created.</p>
                        <p><a name="subscription-anchor-date"></a></p>
                        <h3 id="subscription-anchor-date"><a href="#subscription-anchor-date">Subscription Anchor
                            Date</a></h3>
                        <p>By default, the billing cycle anchor is the date the subscription was
                            created, or if a trial period is used, the date that the trial ends. If
                            you would like to modify the billing anchor date, you may use the <code
                                    class=" language-php">anchorBillingCycleOn</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">App<span
                                class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span
                                    class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> User<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">find</span><span class="token punctuation">(</span><span
                                    class="token number">1</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

<span class="token variable">$anchor</span> <span class="token operator">=</span> Carbon<span class="token punctuation">:</span><span
                                    class="token punctuation">:</span><span class="token function">parse</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'first day of next month'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">newSubscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'premium'</span><span
                                    class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">anchorBillingCycleOn</span><span
                                    class="token punctuation">(</span><span class="token variable">$anchor</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">startOfDay</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token variable">$paymentMethod</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>For more information on managing subscription billing cycles, consult the <a
                                href="https://stripe.com/docs/billing/subscriptions/billing-cycle">Stripe billing cycle
                            documentation</a></p>
                        <p><a name="cancelling-subscriptions"></a></p>
                        <h3 id="cancelling-subscriptions"><a href="#cancelling-subscriptions">Cancelling
                            Subscriptions</a></h3>
                        <p>To cancel a subscription, call the <code class=" language-php">cancel</code> method on the
                            user's subscription:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">cancel</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p>When a subscription is cancelled, Cashier will automatically set the <code
                                class=" language-php">ends_at</code> column in your database. This column is used to
                            know when the <code class=" language-php">subscribed</code> method should begin returning
                            <code class=" language-php"><span class="token boolean constant">false</span></code>.
                            For example, if a customer cancels a subscription on March 1st, but the
                            subscription was not scheduled to end until March 5th, the <code class=" language-php">subscribed</code>
                            method will continue to return <code class=" language-php"><span
                                    class="token boolean constant">true</span></code> until March 5th.</p>
                        <p>You may determine if a user has cancelled their subscription but are still on their "grace
                            period" using the <code class=" language-php">onGracePeriod</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">subscription</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">onGracePeriod</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p>If you wish to cancel a subscription immediately, call the <code class=" language-php">cancelNow</code>
                            method on the user's subscription:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">cancelNow</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p><a name="resuming-subscriptions"></a></p>
                        <h3 id="resuming-subscriptions"><a href="#resuming-subscriptions">Resuming Subscriptions</a>
                        </h3>
                        <p>If a user has cancelled their subscription and you wish to resume it, use the <code
                                class=" language-php">resume</code> method. The user <strong>must</strong> still be on
                            their grace period in order to resume a subscription:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">subscription</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">resume</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span></code></pre>
                        <p>If the user cancels a subscription and then resumes that subscription
                            before the subscription has fully expired, they will not be billed
                            immediately. Instead, their subscription will be re-activated, and they
                            will be billed on the original billing cycle.</p>
                        <p><a name="subscription-trials"></a></p>
                        <h2 id="subscription-trials"><a href="#subscription-trials">Subscription Trials</a></h2>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content">
                                    Cashier manages trial dates for subscriptions and does not derive them
                                    from the Stripe plan. Therefore, you should configure your plan in
                                    Stripe to have a trial period of zero days so that Cashier can manage
                                    the trials instead.</p></div>
                        </blockquote>
                        <p><a name="with-payment-method-up-front"></a></p>
                        <h3 id="with-payment-method-up-front"><a href="#with-payment-method-up-front">With Payment
                            Method Up Front</a></h3>
                        <p>If you would like to offer trial periods to your customers while
                            still collecting payment method information up front, you should use the
                            <code class=" language-php">trialDays</code> method when creating your subscriptions:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">newSubscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'monthly'</span><span
                                    class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">trialDays</span><span
                                    class="token punctuation">(</span><span class="token number">10</span><span
                                    class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token variable">$paymentMethod</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>This method will set the trial period ending date on the subscription
                            record within the database, as well as instruct Stripe to not begin
                            billing the customer until after this date. When using the <code class=" language-php">trialDays</code>
                            method, Cashier will overwrite any default trial period configured for the plan in Stripe.
                        </p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content">
                                    If the customer's subscription is not cancelled before the trial ending
                                    date they will be charged as soon as the trial expires, so you should
                                    be sure to notify your users of their trial ending date.</p></div>
                        </blockquote>
                        <p>The <code class=" language-php">trialUntil</code> method allows you to provide a <code
                                class=" language-php">DateTime</code> instance to specify when the trial period should
                            end:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">Carbon<span
                                class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">newSubscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'monthly'</span><span
                                    class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">trialUntil</span><span
                                    class="token punctuation">(</span>Carbon<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">now</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">addDays</span><span
                                    class="token punctuation">(</span><span class="token number">10</span><span
                                    class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token variable">$paymentMethod</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>You may determine if the user is within their trial period using either the <code
                                class=" language-php">onTrial</code> method of the user instance, or the <code
                                class=" language-php">onTrial</code> method of the subscription instance. The two
                            examples below are identical:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">onTrial</span><span
                                class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                class="token punctuation">)</span><span class="token punctuation">)</span> <span
                                class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">subscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">onTrial</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p><a name="without-payment-method-up-front"></a></p>
                        <h3 id="without-payment-method-up-front"><a href="#without-payment-method-up-front">Without
                            Payment Method Up Front</a></h3>
                        <p>If you would like to offer trial periods without collecting the user's payment method
                            information up front, you may set the <code class=" language-php">trial_ends_at</code>
                            column on the user record to your desired trial ending date. This is typically done during
                            user registration:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">create</span><span
                                class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// Populate other user properties...</span>
    <span class="token single-quoted-string string">'trial_ends_at'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token function">now</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">addDays</span><span class="token punctuation">(</span><span
                                    class="token number">10</span><span class="token punctuation">)</span><span
                                    class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> Be sure to add a <a
                                        href="#date-mutators">date
                                    mutator</a> for <code class=" language-php">trial_ends_at</code> to your model
                                    definition.</p></div>
                        </blockquote>
                        <p>Cashier refers to this type of trial as a "generic trial", since it is not attached to any
                            existing subscription. The <code class=" language-php">onTrial</code> method on the <code
                                    class=" language-php">User</code> instance will return <code
                                    class=" language-php"><span class="token boolean constant">true</span></code> if the
                            current date is not past the value of <code class=" language-php">trial_ends_at</code>:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">onTrial</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// User is within their trial period...</span>
<span class="token punctuation">}</span></code></pre>
                        <p>You may also use the <code class=" language-php">onGenericTrial</code>
                            method if you wish to know specifically that the user is within their
                            "generic" trial period and has not created an actual subscription yet:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">if</span> <span class="token punctuation">(</span><span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span
                                class="token function">onGenericTrial</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// User is within their "generic" trial period...</span>
<span class="token punctuation">}</span></code></pre>
                        <p>Once you are ready to create an actual subscription for the user, you may use the <code
                                class=" language-php">newSubscription</code> method as usual:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span> <span
                                class="token operator">=</span> User<span class="token punctuation">:</span><span
                                class="token punctuation">:</span><span class="token function">find</span><span
                                class="token punctuation">(</span><span class="token number">1</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">newSubscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'monthly'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token variable">$paymentMethod</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="extending-trials"></a></p>
                        <h3 id="extending-trials"><a href="#extending-trials">Extending Trials</a></h3>
                        <p>The <code class=" language-php">extendTrial</code> method allows you to extend the trial
                            period of a subscription after it's been created:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token comment">// End the trial 7 days from now...</span>
<span class="token variable">$subscription</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">extendTrial</span><span class="token punctuation">(</span>
    <span class="token function">now</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">addDays</span><span
                                    class="token punctuation">(</span><span class="token number">7</span><span
                                    class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add an additional 5 days to the trial...</span>
<span class="token variable">$subscription</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">extendTrial</span><span class="token punctuation">(</span>
    <span class="token variable">$subscription</span><span class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">trial_ends_at</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">addDays</span><span class="token punctuation">(</span><span
                                    class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>If the trial has already expired and the customer is already being
                            billed for the subscription, you can still offer them an extended trial.
                            The time spent within the trial period will be deducted from the
                            customer's next invoice.</p>
                        <p><a name="handling-stripe-webhooks"></a></p>
                        <h2 id="handling-stripe-webhooks"><a href="#handling-stripe-webhooks">Handling Stripe
                            Webhooks</a></h2>
                        <blockquote>
                            <div class="callout">
                                <div class="icon purple"><img src="01-Cashier_files/lightbulb.svg"></div>
                                <p class="content"> You may use <a href="https://stripe.com/docs/stripe-cli">the Stripe
                                    CLI</a> to help test webhooks during local development.</p></div>
                        </blockquote>
                        <p>Stripe can notify your application of a variety of events via
                            webhooks. By default, a route that points to Cashier's webhook
                            controller is configured through the Cashier service provider. This
                            controller will handle all incoming webhook requests.</p>
                        <p>By default, this controller will automatically handle cancelling
                            subscriptions that have too many failed charges (as defined by your
                            Stripe settings), customer updates, customer deletions, subscription
                            updates, and payment method changes; however, as we'll soon discover,
                            you can extend this controller to handle any webhook event you like.</p>
                        <p>To ensure your application can handle Stripe webhooks, be sure to
                            configure the webhook URL in the Stripe control panel. The full list of
                            all webhooks you should configure in the Stripe control panel are:</p>
                        <ul>
                            <li><code class=" language-php">customer<span class="token punctuation">.</span>subscription<span
                                    class="token punctuation">.</span>updated</code></li>
                            <li><code class=" language-php">customer<span class="token punctuation">.</span>subscription<span
                                    class="token punctuation">.</span>deleted</code></li>
                            <li><code class=" language-php">customer<span
                                    class="token punctuation">.</span>updated</code></li>
                            <li><code class=" language-php">customer<span
                                    class="token punctuation">.</span>deleted</code></li>
                            <li><code class=" language-php">invoice<span class="token punctuation">.</span>payment_action_required</code>
                            </li>
                        </ul>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> Make sure you protect incoming requests with Cashier's included <a
                                        href="#verifying-webhook-signatures">webhook
                                    signature verification</a> middleware.</p></div>
                        </blockquote>
                        <h4>Webhooks &amp; CSRF Protection</h4>
                        <p>Since Stripe webhooks need to bypass Laravel's <a href="https://laravel.com/docs/7.x/csrf">CSRF
                            protection</a>, be sure to list the URI as an exception in your <code class=" language-php">VerifyCsrfToken</code>
                            middleware or list the route outside of the <code class=" language-php">web</code>
                            middleware group:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">protected</span> <span class="token variable">$except</span> <span
                                class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'stripe/*'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
                        <p><a name="defining-webhook-event-handlers"></a></p>
                        <h3 id="defining-webhook-event-handlers"><a href="#defining-webhook-event-handlers">Defining
                            Webhook Event Handlers</a></h3>
                        <p>Cashier automatically handles subscription cancellation on failed
                            charges, but if you have additional webhook events you would like to
                            handle, extend the Webhook controller. Your method names should
                            correspond to Cashier's expected convention, specifically, methods
                            should be prefixed with <code class=" language-php">handle</code> and the "camel case" name
                            of the webhook you wish to handle. For example, if you wish to handle the <code
                                    class=" language-php">invoice<span class="token punctuation">.</span>payment_succeeded</code>
                            webhook, you should add a <code class=" language-php">handleInvoicePaymentSucceeded</code>
                            method to the controller:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span
                                    class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span
                                    class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span
                                    class="token punctuation">\</span>WebhookController</span> <span
                                    class="token keyword">as</span> CashierController<span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">WebhookController</span> <span
                                    class="token keyword">extends</span> <span class="token class-name">CashierController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Handle invoice payment succeeded.
     *
     * @param  array  $payload
     * @return \Symfony\Component\HttpFoundation\Response
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handleInvoicePaymentSucceeded</span><span
                                    class="token punctuation">(</span><span class="token variable">$payload</span><span
                                    class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Handle The Event</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <p>Next, define a route to your Cashier controller within your <code class=" language-php">routes<span
                                class="token operator">/</span>web<span class="token punctuation">.</span>php</code>
                            file. This will overwrite the default shipped route:</p>
                        <pre class=" language-php"><code class=" language-php">Route<span
                                class="token punctuation">:</span><span class="token punctuation">:</span><span
                                class="token function">post</span><span class="token punctuation">(</span>
    <span class="token single-quoted-string string">'stripe/webhook'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'\App\Http\Controllers\WebhookController@handleWebhook'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>Cashier emits a <code class=" language-php">Laravel\<span class="token package">Cashier<span
                                class="token punctuation">\</span>Events<span class="token punctuation">\</span>WebhookReceived</span></code>
                            event when a webhook is received, and a <code class=" language-php">Laravel\<span
                                    class="token package">Cashier<span class="token punctuation">\</span>Events<span
                                    class="token punctuation">\</span>WebhookHandled</span></code> event when a webhook
                            was handled by Cashier. Both events contain the full payload of the Stripe webhook.</p>
                        <p><a name="handling-failed-subscriptions"></a></p>
                        <h3 id="handling-failed-subscriptions"><a href="#handling-failed-subscriptions">Failed
                            Subscriptions</a></h3>
                        <p>What if a customer's credit card expires? No worries - Cashier's
                            Webhook controller will cancel the customer's subscription for you.
                            Failed payments will automatically be captured and handled by the
                            controller. The controller will cancel the customer's subscription when
                            Stripe determines the subscription has failed (normally after three
                            failed payment attempts).</p>
                        <p><a name="verifying-webhook-signatures"></a></p>
                        <h3 id="verifying-webhook-signatures"><a href="#verifying-webhook-signatures">Verifying Webhook
                            Signatures</a></h3>
                        <p>To secure your webhooks, you may use <a href="https://stripe.com/docs/webhooks/signatures">Stripe's
                            webhook signatures</a>.
                            For convenience, Cashier automatically includes a middleware which
                            validates that the incoming Stripe webhook request is valid.</p>
                        <p>To enable webhook verification, ensure that the <code class=" language-php"><span
                                class="token constant">STRIPE_WEBHOOK_SECRET</span></code> environment variable is set
                            in your <code class=" language-php"><span class="token punctuation">.</span>env</code> file.
                            The webhook <code class=" language-php">secret</code> may be retrieved from your Stripe
                            account dashboard.</p>
                        <p><a name="single-charges"></a></p>
                        <h2 id="single-charges"><a href="#single-charges">Single Charges</a></h2>
                        <p><a name="simple-charge"></a></p>
                        <h3 id="simple-charge"><a href="#simple-charge">Simple Charge</a></h3>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> The <code class=" language-php">charge</code> method accepts the
                                    amount you would like to charge in the <strong>lowest denominator of the currency
                                        used by your application</strong>.</p></div>
                        </blockquote>
                        <p>If you would like to make a "one off" charge against a subscribed customer's payment method,
                            you may use the <code class=" language-php">charge</code> method on a billable model
                            instance. You'll need to <a href="#storing-payment-methods">provide a payment method
                                identifier</a> as the second argument:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token comment">// Stripe Accepts Charges In Cents...</span>
<span class="token variable">$stripeCharge</span> <span class="token operator">=</span> <span class="token variable">$user</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">charge</span><span class="token punctuation">(</span><span
                                    class="token number">100</span><span class="token punctuation">,</span> <span
                                    class="token variable">$paymentMethod</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>The <code class=" language-php">charge</code> method accepts an array
                            as its third argument, allowing you to pass any options you wish to the
                            underlying Stripe charge creation. Consult the Stripe documentation
                            regarding the options available to you when creating charges:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">charge</span><span class="token punctuation">(</span><span
                                class="token number">100</span><span class="token punctuation">,</span> <span
                                class="token variable">$paymentMethod</span><span
                                class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'custom_option'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token variable">$value</span><span
                                    class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>You may also use the <code class=" language-php">charge</code> method without an underlying
                            customer or user:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">App<span
                                class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token variable">$stripeCharge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span
                                    class="token keyword">new</span> <span class="token class-name">User</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">charge</span><span
                                    class="token punctuation">(</span><span class="token number">100</span><span
                                    class="token punctuation">,</span> <span
                                    class="token variable">$paymentMethod</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>The <code class=" language-php">charge</code> method will throw an exception if the charge
                            fails. If the charge is successful, an instance of <code class=" language-php">Laravel\<span
                                    class="token package">Cashier<span class="token punctuation">\</span>Payment</span></code>
                            will be returned from the method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token variable">$payment</span> <span class="token operator">=</span> <span class="token variable">$user</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">charge</span><span class="token punctuation">(</span><span
                                    class="token number">100</span><span class="token punctuation">,</span> <span
                                    class="token variable">$paymentMethod</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span
                                    class="token punctuation">(</span>Exception <span
                                    class="token variable">$e</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span></code></pre>
                        <p><a name="charge-with-invoice"></a></p>
                        <h3 id="charge-with-invoice"><a href="#charge-with-invoice">Charge With Invoice</a></h3>
                        <p>Sometimes you may need to make a one-time charge but also generate an
                            invoice for the charge so that you may offer a PDF receipt to your
                            customer. The <code class=" language-php">invoiceFor</code> method lets you do just that.
                            For example, let's invoice the customer $5.00 for a "One Time Fee":</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token comment">// Stripe Accepts Charges In Cents...</span>
<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">invoiceFor</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'One Time Fee'</span><span
                                    class="token punctuation">,</span> <span class="token number">500</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>The invoice will be charged immediately against the user's default payment method. The <code
                                class=" language-php">invoiceFor</code>
                            method also accepts an array as its third argument. This array contains
                            the billing options for the invoice item. The fourth argument accepted
                            by the method is also an array. This final argument accepts the billing
                            options for the invoice itself:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$user</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">invoiceFor</span><span class="token punctuation">(</span><span
                                class="token single-quoted-string string">'Stickers'</span><span
                                class="token punctuation">,</span> <span class="token number">500</span><span
                                class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'quantity'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token number">50</span><span
                                    class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span
                                    class="token punctuation">[</span>
    <span class="token single-quoted-string string">'default_tax_rates'</span> <span
                                    class="token operator">=</span><span class="token operator">&gt;</span> <span
                                    class="token punctuation">[</span><span class="token single-quoted-string string">'tax-rate-id'</span><span
                                    class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> The <code class=" language-php">invoiceFor</code>
                                    method will create a Stripe invoice which will retry failed billing
                                    attempts. If you do not want invoices to retry failed charges, you will
                                    need to close them using the Stripe API after the first failed charge.</p></div>
                        </blockquote>
                        <p><a name="refunding-charges"></a></p>
                        <h3 id="refunding-charges"><a href="#refunding-charges">Refunding Charges</a></h3>
                        <p>If you need to refund a Stripe charge, you may use the <code
                                class=" language-php">refund</code> method. This method accepts the Stripe Payment
                            Intent ID as its first argument:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token variable">$payment</span> <span class="token operator">=</span> <span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">charge</span><span
                                class="token punctuation">(</span><span class="token number">100</span><span
                                class="token punctuation">,</span> <span
                                class="token variable">$paymentMethod</span><span
                                class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">refund</span><span
                                    class="token punctuation">(</span><span class="token variable">$payment</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">id</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="invoices"></a></p>
                        <h2 id="invoices"><a href="#invoices">Invoices</a></h2>
                        <p>You may easily retrieve an array of a billable model's invoices using the <code
                                class=" language-php">invoices</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token variable">$invoices</span> <span class="token operator">=</span> <span
                                class="token variable">$user</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">invoices</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span>

<span class="token comment">// Include pending invoices in the results...</span>
<span class="token variable">$invoices</span> <span class="token operator">=</span> <span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">invoicesIncludingPending</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>When listing the invoices for the customer, you may use the invoice's
                            helper methods to display the relevant invoice information. For
                            example, you may wish to list every invoice in a table, allowing the
                            user to easily download any of them:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token operator">&lt;</span>table<span
                                class="token operator">&gt;</span>
    @<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$invoices</span> <span
                                    class="token keyword">as</span> <span class="token variable">$invoice</span><span
                                    class="token punctuation">)</span>
        <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span
                                    class="token punctuation">{</span><span class="token punctuation">{</span> <span
                                    class="token variable">$invoice</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">date</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">toFormattedDateString</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">}</span><span class="token punctuation">}</span><span
                                    class="token operator">&lt;</span><span class="token operator">/</span>td<span
                                    class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span
                                    class="token punctuation">{</span><span class="token punctuation">{</span> <span
                                    class="token variable">$invoice</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">total</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">}</span><span class="token punctuation">}</span><span
                                    class="token operator">&lt;</span><span class="token operator">/</span>td<span
                                    class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span
                                    class="token operator">&lt;</span>a href<span class="token operator">=</span><span
                                    class="token double-quoted-string string">"/user/invoice/{{ <span
                                    class="token interpolation"><span class="token variable">$invoice</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">id</span></span> }}"</span><span
                                    class="token operator">&gt;</span>Download<span
                                    class="token operator">&lt;</span><span class="token operator">/</span>a<span
                                    class="token operator">&gt;</span><span class="token operator">&lt;</span><span
                                    class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span
                                    class="token operator">&gt;</span>
    @<span class="token keyword">endforeach</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>table<span
                                    class="token operator">&gt;</span></code></pre>
                        <p><a name="generating-invoice-pdfs"></a></p>
                        <h3 id="generating-invoice-pdfs"><a href="#generating-invoice-pdfs">Generating Invoice PDFs</a>
                        </h3>
                        <p>From within a route or controller, use the <code class=" language-php">downloadInvoice</code>
                            method to generate a PDF download of the invoice. This method will
                            automatically generate the proper HTTP response to send the download to
                            the browser:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">Illuminate<span
                                class="token punctuation">\</span>Http<span
                                class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">get</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'user/invoice/{invoice}'</span><span
                                    class="token punctuation">,</span> <span class="token keyword">function</span> <span
                                    class="token punctuation">(</span>Request <span
                                    class="token variable">$request</span><span class="token punctuation">,</span> <span
                                    class="token variable">$invoiceId</span><span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$request</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">user</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">downloadInvoice</span><span
                                    class="token punctuation">(</span><span
                                    class="token variable">$invoiceId</span><span
                                    class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'vendor'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token single-quoted-string string">'Your Company'</span><span
                                    class="token punctuation">,</span>
        <span class="token single-quoted-string string">'product'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token single-quoted-string string">'Your Product'</span><span
                                    class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>The <code class=" language-php">downloadInvoice</code> method also allows for an optional
                            custom filename as the third parameter. This filename will automatically be suffixed with
                            <code class=" language-php"><span class="token punctuation">.</span>pdf</code> for you:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token keyword">return</span> <span
                                class="token variable">$request</span><span class="token operator">-</span><span
                                class="token operator">&gt;</span><span class="token function">user</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">downloadInvoice</span><span
                                class="token punctuation">(</span><span class="token variable">$invoiceId</span><span
                                class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'vendor'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token single-quoted-string string">'Your Company'</span><span
                                    class="token punctuation">,</span>
    <span class="token single-quoted-string string">'product'</span> <span class="token operator">=</span><span
                                    class="token operator">&gt;</span> <span class="token single-quoted-string string">'Your Product'</span><span
                                    class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span
                                    class="token single-quoted-string string">'my-invoice'</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="handling-failed-payments"></a></p>
                        <h2 id="handling-failed-payments"><a href="#handling-failed-payments">Handling Failed
                            Payments</a></h2>
                        <p>Sometimes, payments for subscriptions or single charges can fail. When this happens, Cashier
                            will throw an <code class=" language-php">IncompletePayment</code> exception that informs
                            you that this happened. After catching this exception, you have two options on how to
                            proceed.</p>
                        <p>First, you could redirect your customer to the dedicated payment
                            confirmation page which is included with Cashier. This page already has
                            an associated route that is registered via Cashier's service provider.
                            So, you may catch the <code class=" language-php">IncompletePayment</code> exception and
                            redirect to the payment confirmation page:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">Laravel<span
                                class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>Exceptions<span
                                class="token punctuation">\</span>IncompletePayment</span><span
                                class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token variable">$subscription</span> <span class="token operator">=</span> <span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">newSubscription</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'default'</span><span
                                    class="token punctuation">,</span> <span class="token variable">$planId</span><span
                                    class="token punctuation">)</span>
                            <span class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">create</span><span class="token punctuation">(</span><span
                                    class="token variable">$paymentMethod</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span
                                    class="token punctuation">(</span>IncompletePayment <span class="token variable">$exception</span><span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">redirect</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">route</span><span class="token punctuation">(</span>
        <span class="token single-quoted-string string">'cashier.payment'</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token variable">$exception</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">payment</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">id</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'redirect'</span> <span
                                    class="token operator">=</span><span class="token operator">&gt;</span> <span
                                    class="token function">route</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'home'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
                        <p>On the payment confirmation page, the customer will be prompted to
                            enter their credit card info again and perform any additional actions
                            required by Stripe, such as "3D Secure" confirmation. After confirming
                            their payment, the user will be redirected to the URL provided by the <code
                                    class=" language-php">redirect</code> parameter specified above. Upon redirection,
                            <code class=" language-php">message</code> (string) and <code
                                    class=" language-php">success</code> (integer) query string variables will be added
                            to the URL.</p>
                        <p>Alternatively, you could allow Stripe to handle the payment
                            confirmation for you. In this case, instead of redirecting to the
                            payment confirmation page, you may <a
                                    href="https://dashboard.stripe.com/account/billing/automatic">setup Stripe's
                                automatic billing emails</a> in your Stripe dashboard. However, if a <code
                                    class=" language-php">IncompletePayment</code>
                            exception is caught, you should still inform the user they will receive
                            an email with further payment confirmation instructions.</p>
                        <p>Payment exceptions may be thrown for the following methods: <code class=" language-php">charge</code>,
                            <code class=" language-php">invoiceFor</code>, and <code
                                    class=" language-php">invoice</code> on the <code
                                    class=" language-php">Billable</code> user. When handling subscriptions, the <code
                                    class=" language-php">create</code> method on the <code class=" language-php">SubscriptionBuilder</code>,
                            and the <code class=" language-php">incrementAndInvoice</code> and <code
                                    class=" language-php">swapAndInvoice</code> methods on the <code
                                    class=" language-php">Subscription</code> model may throw exceptions.</p>
                        <p>There are currently two types of payment exceptions which extend <code class=" language-php">IncompletePayment</code>.
                            You can catch these separately if needed so that you can customize the user experience:</p>
                        <div class="content-list">
                            <ul>
                                <li><code class=" language-php">PaymentActionRequired</code>: this indicates that Stripe
                                    requires extra verification in order to confirm and process a payment.
                                </li>
                                <li><code class=" language-php">PaymentFailure</code>: this indicates that a payment
                                    failed for various other reasons, such as being out of available funds.
                                </li>
                            </ul>
                        </div>
                        <p><a name="strong-customer-authentication"></a></p>
                        <h2 id="strong-customer-authentication"><a href="#strong-customer-authentication">Strong
                            Customer Authentication</a></h2>
                        <p>If your business is based in Europe you will need to abide by the
                            Strong Customer Authentication (SCA) regulations. These regulations were
                            imposed&nbsp;in September 2019 by the European Union to prevent payment
                            fraud. Luckily, Stripe and Cashier are prepared for building SCA
                            compliant applications.</p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content"> Before getting started, review <a
                                        href="https://stripe.com/guides/strong-customer-authentication">Stripe's guide
                                    on PSD2 and SCA</a> as well as their <a
                                        href="https://stripe.com/docs/strong-customer-authentication">documentation on
                                    the new SCA APIs</a>.</p></div>
                        </blockquote>
                        <p><a name="payments-requiring-additional-confirmation"></a></p>
                        <h3 id="payments-requiring-additional-confirmation"><a
                                href="#payments-requiring-additional-confirmation">Payments Requiring Additional
                            Confirmation</a></h3>
                        <p>SCA regulations often require extra verification in order to confirm
                            and process a payment. When this happens, Cashier will throw a <code class=" language-php">PaymentActionRequired</code>
                            exception that informs you that this extra verification is needed. More info on how to
                            handle these exceptions be found <a href="#handling-failed-payments">here</a>.</p>
                        <h4>Incomplete and Past Due State</h4>
                        <p>When a payment needs additional confirmation, the subscription will remain in an <code
                                class=" language-php">incomplete</code> or <code class=" language-php">past_due</code>
                            state as indicated by its <code class=" language-php">stripe_status</code>
                            database column. Cashier will automatically activate the customer's
                            subscription via a webhook as soon as payment confirmation is complete.</p>
                        <p>For more information on <code class=" language-php">incomplete</code> and <code
                                class=" language-php">past_due</code> states, please refer to <a
                                href="#incomplete-and-past-due-status">our additional documentation</a>.</p>
                        <p><a name="off-session-payment-notifications"></a></p>
                        <h3 id="off-session-payment-notifications"><a href="#off-session-payment-notifications">Off-Session
                            Payment Notifications</a></h3>
                        <p>Since SCA regulations require customers to occasionally verify their
                            payment details even while their subscription is active, Cashier can
                            send a payment notification to the customer when off-session payment
                            confirmation is required. For example, this may occur when a
                            subscription is renewing. Cashier's payment notification can be enabled
                            by setting the <code class=" language-php"><span class="token constant">CASHIER_PAYMENT_NOTIFICATION</span></code>
                            environment variable to a notification class. By default, this
                            notification is disabled. Of course, Cashier includes a notification
                            class you may use for this purpose, but you are free to provide your own
                            notification class if desired:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token constant">CASHIER_PAYMENT_NOTIFICATION</span><span
                                class="token operator">=</span>Laravel\<span class="token package">Cashier<span
                                class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>ConfirmPayment</span></code></pre>
                        <p>To ensure that off-session payment confirmation notifications are delivered, verify that <a
                                href="#handling-stripe-webhooks">Stripe webhooks are configured</a> for your application
                            and the <code class=" language-php">invoice<span class="token punctuation">.</span>payment_action_required</code>
                            webhook is enabled in your Stripe dashboard. In addition, your <code class=" language-php">Billable</code>
                            model should also use Laravel's <code class=" language-php">Illuminate\<span
                                    class="token package">Notifications<span class="token punctuation">\</span>Notifiable</span></code>
                            trait.</p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="01-Cashier_files/exclamation.svg"></div>
                                <p class="content">
                                    Notifications will be sent even when customers are manually making a
                                    payment that requires additional confirmation. Unfortunately, there is
                                    no way for Stripe to know that the payment was done manually or
                                    "off-session". But, a customer will simply see a "Payment Successful"
                                    message if they visit the payment page after already confirming their
                                    payment. The customer will not be allowed to accidentally confirm the
                                    same payment twice and incur an accidental second charge.</p></div>
                        </blockquote>
                        <p><a name="stripe-sdk"></a></p>
                        <h2 id="stripe-sdk"><a href="#stripe-sdk">Stripe SDK</a></h2>
                        <p>Many of Cashier's objects are wrappers around Stripe SDK objects. If
                            you would like to interact with the Stripe objects directly, you may
                            conveniently retrieve them using the <code class=" language-php">asStripe</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token variable">$stripeSubscription</span> <span
                                class="token operator">=</span> <span class="token variable">$subscription</span><span
                                class="token operator">-</span><span class="token operator">&gt;</span><span
                                class="token function">asStripeSubscription</span><span
                                class="token punctuation">(</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span>

<span class="token variable">$stripeSubscription</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">update</span><span
                                    class="token punctuation">(</span><span class="token punctuation">[</span><span
                                    class="token single-quoted-string string">'application_fee_percent'</span> <span
                                    class="token operator">=</span><span class="token operator">&gt;</span> <span
                                    class="token number">5</span><span class="token punctuation">]</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="testing"></a></p>
                        <h2 id="testing"><a href="#testing">Testing</a></h2>
                        <p>When testing an application that uses Cashier, you may mock the
                            actual HTTP requests to the Stripe API; however, this requires you to
                            partially re-implement Cashier's own behavior. Therefore, we recommend
                            allowing your tests to hit the actual Stripe API. While this is slower,
                            it provides more confidence that your application is working as expected
                            and any slow tests may be placed within their own PHPUnit testing
                            group.</p>
                        <p>When testing, remember that that Cashier itself already has a great
                            test suite, so you should only focus on testing the subscription and
                            payment flow of your own application and not every underlying Cashier
                            behavior.</p>
                        <p>To get started, add the <strong>testing</strong> version of your Stripe secret to your <code
                                class=" language-php">phpunit<span class="token punctuation">.</span>xml</code> file:
                        </p>
                        <pre class=" language-php"><code class=" language-php"><span class="token operator">&lt;</span>env name<span
                                class="token operator">=</span><span class="token double-quoted-string string">"STRIPE_SECRET"</span> value<span
                                class="token operator">=</span><span class="token double-quoted-string string">"sk_test_&lt;your-key&gt;"</span><span
                                class="token operator">/</span><span class="token operator">&gt;</span></code></pre>
                        <p>Now, whenever you interact with Cashier while testing, it will send
                            actual API requests to your Stripe testing environment. For convenience,
                            you should pre-fill your Stripe testing account with subscriptions /
                            plans that you may then use during testing.</p>
                        <blockquote>
                            <div class="callout">
                                <div class="icon purple"><img src="01-Cashier_files/lightbulb.svg"></div>
                                <p class="content"> In order to test a variety of billing scenarios, such as credit card
                                    denials and failures, you may use the vast range of <a
                                            href="https://stripe.com/docs/testing">testing card numbers and tokens</a>
                                    provided by Stripe.</p></div>
                        </blockquote>
                    </section>
                </section>
            </section>
        </div>
    </div>

</div>

</body>
<script src="../index_files/app.js.download"></script>
</html>