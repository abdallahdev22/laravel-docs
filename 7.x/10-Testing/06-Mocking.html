<!DOCTYPE html>
<html class="gr__laravel_com" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Mocking - Laravel - The PHP Framework For Web Artisans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <link rel="canonical" href="https://laravel.com/docs/7.x/mocking">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://laravel.com/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://laravel.com/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://laravel.com/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://laravel.com/img/favicon/site.webmanifest">
    <link rel="mask-icon" href="https://laravel.com/img/favicon/safari-pinned-tab.svg" color="#ff2d20">
    <link rel="shortcut icon" href="https://laravel.com/img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#ff2d20">
    <meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Load fonts -->
    <link rel="stylesheet" href="06-Mocking_files/ins2wgm.css">

    <!-- Load styles -->
    <link rel="stylesheet" type="text/css" href="06-Mocking_files/app.css">

    <!-- Load JS -->
    <script src="06-Mocking_files/jquery.js"></script>

    <script id="_carbonads_projs" type="text/javascript" src="06-Mocking_files/CKYILK3E.json"></script>
</head>
<body class="language-php" data-gr-c-s-loaded="true">

<div class="sidebar_layout" id="docsScreen">

    <div class="page_contain">
        <div class="contain">
            <aside class="sidebar">
                <a href="../index.html" class="logo">
                    <img class="mark" src="../index_files/logomark.min.svg" alt="Laravel">
                    <img class="type" src="../index_files/logotype.min.svg" alt="Laravel">
                </a>
                <nav>
                    <div class="navigation_contain" style="display: block;">
                        <div class="docs_sidebar">
                            <ul>
                                <li>
                                    <h2>Prologue</h2>
                                    <ul>
                                        <li><a href="../01-Prologue/01-Release%20Notes.html">Release Notes</a></li>
                                        <li><a href="../01-Prologue/02-Upgrade%20Guide.html">Upgrade Guide</a></li>
                                        <li><a href="../01-Prologue/03-Contribution%20Guide.html">Contribution Guide</a>
                                        </li>
                                        <li><a href="https://laravel.com/api/7.x">API Documentation</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Getting Started</h2>
                                    <ul>
                                        <li><a href="../02-Getting%20Started/01-Installation.html">Installation</a></li>
                                        <li><a href="../02-Getting%20Started/02-Configuration.html">Configuration</a>
                                        </li>
                                        <li><a href="../02-Getting%20Started/03-Directory%20Structure.html">Directory
                                            Structure</a>
                                        </li>
                                        <li><a href="../02-Getting%20Started/04-Homestead.html">Homestead</a></li>
                                        <li><a href="../02-Getting%20Started/05-Valet.html">Valet</a></li>
                                        <li><a href="../02-Getting%20Started/06-Deployment.html">Deployment</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Architecture Concepts</h2>
                                    <ul>
                                        <li><a href="../03-Architecture%20Concepts/01-Request%20Lifecycle.html">Request
                                            Lifecycle</a></li>
                                        <li><a href="../03-Architecture%20Concepts/02-Service%20Container.html">Service
                                            Container</a></li>
                                        <li><a href="../03-Architecture%20Concepts/03-Service%20Providers.html">Service
                                            Providers</a></li>
                                        <li><a href="../03-Architecture%20Concepts/04-Facades.html">Facades</a></li>
                                        <li><a href="../03-Architecture%20Concepts/05-Contracts.html">Contracts</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>The Basics</h2>
                                    <ul>
                                        <li><a href="../04-The%20Basics/01-Routing.html">Routing</a></li>
                                        <li><a href="../04-The%20Basics/02-Middleware.html">Middleware</a></li>
                                        <li><a href="../04-The%20Basics/03-CSRF%20Protection.html">CSRF Protection</a>
                                        </li>
                                        <li><a href="../04-The%20Basics/04-Controllers.html">Controllers</a></li>
                                        <li><a href="../04-The%20Basics/05-Requests.html">Requests</a></li>
                                        <li><a href="../04-The%20Basics/06-Responses.html">Responses</a></li>
                                        <li><a href="../04-The%20Basics/07-Views.html">Views</a></li>
                                        <li><a href="../04-The%20Basics/08-URL%20Generation.html">URL Generation</a>
                                        </li>
                                        <li><a href="../04-The%20Basics/09-Session.html">Session</a></li>
                                        <li><a href="../04-The%20Basics/10-Validation.html">Validation</a></li>
                                        <li><a href="../04-The%20Basics/11-Error%20Handling.html">Error Handling</a>
                                        </li>
                                        <li><a href="../04-The%20Basics/12-Logging.html">Logging</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Frontend</h2>
                                    <ul>
                                        <li><a href="../05-Frontend/01-Blade%20Templates.html">Blade Templates</a></li>
                                        <li><a href="../05-Frontend/02-Localization.html">Localization</a></li>
                                        <li><a href="../05-Frontend/03-Frontend%20Scaffolding.html">Frontend
                                            Scaffolding</a></li>
                                        <li><a href="../05-Frontend/04-Compiling%20Assets.html">Compiling Assets</a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Security</h2>
                                    <ul>
                                        <li><a href="../06-Security/01-Authentication.html">Authentication</a></li>
                                        <li><a href="../06-Security/02-Authorization.html">Authorization</a></li>
                                        <li><a href="../06-Security/03-Email%20Verification.html">Email Verification</a>
                                        </li>
                                        <li><a href="../06-Security/04-Encryption.html">Encryption</a></li>
                                        <li><a href="../06-Security/05-Hashing.html">Hashing</a></li>
                                        <li><a href="../06-Security/06-Password%20Reset.html">Password Reset</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Digging Deeper</h2>
                                    <ul>
                                        <li><a href="../07-Digging%20Deeper/01-Artisan%20Console.html">Artisan
                                            Console</a></li>
                                        <li><a href="../07-Digging%20Deeper/02-Broadcasting.html">Broadcasting</a></li>
                                        <li><a href="../07-Digging%20Deeper/03-Cache.html">Cache</a></li>
                                        <li><a href="../07-Digging%20Deeper/04-Collections.html">Collections</a></li>
                                        <li><a href="../07-Digging%20Deeper/05-Events.html">Events</a></li>
                                        <li><a href="../07-Digging%20Deeper/06-File%20Storage.html">File Storage</a>
                                        </li>
                                        <li><a href="../07-Digging%20Deeper/07-Helpers.html">Helpers</a></li>
                                        <li><a href="../07-Digging%20Deeper/08-HTTP%20Client.html">HTTP Client</a></li>
                                        <li><a href="../07-Digging%20Deeper/09-Mail.html">Mail</a></li>
                                        <li><a href="../07-Digging%20Deeper/10-Notifications.html">Notifications</a>
                                        </li>
                                        <li><a href="../07-Digging%20Deeper/11-Package%20Development.html">Package
                                            Development</a>
                                        </li>
                                        <li><a href="../07-Digging%20Deeper/12-Queues.html">Queues</a></li>
                                        <li><a href="../07-Digging%20Deeper/13-Task%20Scheduling.html">Task
                                            Scheduling</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Database</h2>
                                    <ul>
                                        <li><a href="../08-Database/01-Getting%20Started.html">Getting Started</a></li>
                                        <li><a href="../08-Database/02-Query%20Builder.html">Query Builder</a></li>
                                        <li><a href="../08-Database/03-Pagination.html">Pagination</a></li>
                                        <li><a href="../08-Database/04-Migrations.html">Migrations</a></li>
                                        <li><a href="../08-Database/05-Seeding.html">Seeding</a></li>
                                        <li><a href="../08-Database/06-Redis.html">Redis</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Eloquent ORM</h2>
                                    <ul>
                                        <li><a href="../09-Eloquent%20ORM/01-Getting%20Started.html">Getting Started</a>
                                        </li>
                                        <li><a href="../09-Eloquent%20ORM/02-Relationships.html">Relationships</a></li>
                                        <li><a href="../09-Eloquent%20ORM/03-Collections.html">Collections</a></li>
                                        <li><a href="../09-Eloquent%20ORM/04-Mutators.html">Mutators</a></li>
                                        <li><a href="../09-Eloquent%20ORM/05-API%20Resources.html">API Resources</a>
                                        </li>
                                        <li><a href="../09-Eloquent%20ORM/06-Serialization.html">Serialization</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Testing</h2>
                                    <ul>
                                        <li><a href="../10-Testing/01-Getting%20Started.html">Getting Started</a></li>
                                        <li><a href="../10-Testing/02-HTTP%20Tests.html">HTTP Tests</a></li>
                                        <li><a href="../10-Testing/03-Console%20Tests.html">Console Tests</a></li>
                                        <li><a href="../10-Testing/04-Browser%20Tests.html">Browser Tests</a></li>
                                        <li><a href="../10-Testing/05-Database.html">Database</a></li>
                                        <li><a href="../10-Testing/06-Mocking.html">Mocking</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <h2>Official Packages</h2>
                                    <ul>
                                        <li><a href="../11-Official%20Packages/01-Cashier.html">Cashier (Stripe)</a>
                                        </li>
                                        <li><a href="https://github.com/laravel/cashier-mollie">Cashier (Mollie)</a>
                                        </li>
                                        <li><a href="../11-Official%20Packages/02-Dusk.html">Dusk</a></li>
                                        <li><a href="../11-Official%20Packages/03-Envoy.html">Envoy</a></li>
                                        <li><a href="../11-Official%20Packages/04-Horizon.html">Horizon</a></li>
                                        <li><a href="../11-Official%20Packages/05-Passport.html">Passport</a></li>
                                        <li><a href="../11-Official%20Packages/06-Sanctum.html">Sanctum</a></li>
                                        <li><a href="../11-Official%20Packages/07-Scout.html">Scout</a></li>
                                        <li><a href="../11-Official%20Packages/08-Socialite.html">Socialite</a></li>
                                        <li><a href="../11-Official%20Packages/09-Telescope.html">Telescope</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
                <div class="trigger_contain">
                    <a href="#" class="nav_trigger" aria-label="Menu">
                        <div class="bar"></div>
                    </a>
                </div>
            </aside>

            <section class="body_content">
                <section class="docs_body">
                    <section class="docs_main">
                        <h1>Mocking</h1>
                        <ul>
                            <li><a href="#introduction">Introduction</a></li>
                            <li><a href="#mocking-objects">Mocking Objects</a></li>
                            <li><a href="#bus-fake">Bus Fake</a></li>
                            <li><a href="#event-fake">Event Fake</a>
                                <ul>
                                    <li><a href="#scoped-event-fakes">Scoped Event Fakes</a></li>
                                </ul>
                            </li>
                            <li><a href="#mail-fake">Mail Fake</a></li>
                            <li><a href="#notification-fake">Notification Fake</a></li>
                            <li><a href="#queue-fake">Queue Fake</a></li>
                            <li><a href="#storage-fake">Storage Fake</a></li>
                            <li><a href="#mocking-facades">Facades</a></li>
                        </ul>
                        <p><a name="introduction"></a></p>
                        <h2 id="introduction"><a href="#introduction">Introduction</a></h2>
                        <p>When testing Laravel applications, you may wish to "mock" certain
                            aspects of your application so they are not actually executed during a
                            given test. For example, when testing a controller that dispatches an
                            event, you may wish to mock the event listeners so they are not actually
                            executed during the test. This allows you to only test the controller's
                            HTTP response without worrying about the execution of the event
                            listeners, since the event listeners can be tested in their own test
                            case.</p>
                        <p>Laravel provides helpers for mocking events, jobs, and facades out of
                            the box. These helpers primarily provide a convenience layer over
                            Mockery so you do not have to manually make complicated Mockery method
                            calls. You can also use <a href="http://docs.mockery.io/en/latest/">Mockery</a> or PHPUnit
                            to create your own mocks or spies.</p>
                        <p><a name="mocking-objects"></a></p>
                        <h2 id="mocking-objects"><a href="#mocking-objects">Mocking Objects</a></h2>
                        <p>When mocking an object that is going to be injected into your
                            application via Laravel's service container, you will need to bind your
                            mocked instance into the container as an <code class=" language-php">instance</code>
                            binding. This will instruct the container to use your mocked instance of the object instead
                            of constructing the object itself:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">App<span
                                class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Mockery</span><span
                                    class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">instance</span><span
                                    class="token punctuation">(</span>Service<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span
                                    class="token punctuation">,</span> Mockery<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">mock</span><span
                                    class="token punctuation">(</span>Service<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$mock</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
    <span class="token variable">$mock</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">shouldReceive</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'process'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">once</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p>In order to make this more convenient, you may use the <code
                                class=" language-php">mock</code> method, which is provided by Laravel's base test case
                            class:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">App<span
                                class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">mock</span><span
                                    class="token punctuation">(</span>Service<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$mock</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
    <span class="token variable">$mock</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">shouldReceive</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'process'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">once</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>You may use the <code class=" language-php">partialMock</code> method
                            when you only need to mock a few methods of an object. The methods that
                            are not mocked will be executed normally when called:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">App<span
                                class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">partialMock</span><span class="token punctuation">(</span>Service<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$mock</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
    <span class="token variable">$mock</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">shouldReceive</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'process'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">once</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p>Similarly, if you want to spy on an object, Laravel's base test case class offers a <code
                                class=" language-php">spy</code> method as a convenient wrapper around the <code
                                class=" language-php">Mockery<span class="token punctuation">:</span><span
                                class="token punctuation">:</span>spy</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token keyword">use</span> <span class="token package">App<span
                                class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">spy</span><span
                                    class="token punctuation">(</span>Service<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$mock</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
    <span class="token variable">$mock</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">shouldHaveReceived</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'process'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                        <p><a name="bus-fake"></a></p>
                        <h2 id="bus-fake"><a href="#bus-fake">Bus Fake</a></h2>
                        <p>As an alternative to mocking, you may use the <code class=" language-php">Bus</code> facade's
                            <code class=" language-php">fake</code> method to prevent jobs from being dispatched. When
                            using fakes, assertions are made after the code under test is executed:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span
                                    class="token punctuation">\</span>ShipOrder</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Bus</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span
                                    class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Bus<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Bus<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertDispatched</span><span
                                    class="token punctuation">(</span>ShipOrder<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$job</span><span class="token punctuation">)</span> <span
                                    class="token keyword">use</span> <span class="token punctuation">(</span><span
                                    class="token variable">$order</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$job</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">order</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">id</span> <span
                                    class="token operator">===</span> <span class="token variable">$order</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a job was not dispatched...</span>
        Bus<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotDispatched</span><span
                                    class="token punctuation">(</span>AnotherJob<span class="token punctuation">:</span><span
                                    class="token punctuation">:</span><span class="token keyword">class</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <p><a name="event-fake"></a></p>
                        <h2 id="event-fake"><a href="#event-fake">Event Fake</a></h2>
                        <p>As an alternative to mocking, you may use the <code class=" language-php">Event</code>
                            facade's <code class=" language-php">fake</code>
                            method to prevent all event listeners from executing. You may then
                            assert that events were dispatched and even inspect the data they
                            received. When using fakes, assertions are made after the code under
                            test is executed:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span
                                    class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderFailedToShip</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span
                                    class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Event</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span
                                    class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Test order shipping.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fake</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertDispatched</span><span
                                    class="token punctuation">(</span>OrderShipped<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$e</span><span class="token punctuation">)</span> <span
                                    class="token keyword">use</span> <span class="token punctuation">(</span><span
                                    class="token variable">$order</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">order</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">id</span> <span
                                    class="token operator">===</span> <span class="token variable">$order</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert an event was dispatched twice...</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertDispatched</span><span
                                    class="token punctuation">(</span>OrderShipped<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token number">2</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Assert an event was not dispatched...</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertNotDispatched</span><span
                                    class="token punctuation">(</span>OrderFailedToShip<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="06-Mocking_files/exclamation.svg"></div>
                                <p class="content"> After calling <code class=" language-php">Event<span
                                        class="token punctuation">:</span><span class="token punctuation">:</span><span
                                        class="token function">fake</span><span class="token punctuation">(</span><span
                                        class="token punctuation">)</span></code>,
                                    no event listeners will be executed. So, if your tests use model
                                    factories that rely on events, such as creating a UUID during a model's <code
                                            class=" language-php">creating</code> event, you should call <code
                                            class=" language-php">Event<span class="token punctuation">:</span><span
                                            class="token punctuation">:</span><span
                                            class="token function">fake</span><span
                                            class="token punctuation">(</span><span
                                            class="token punctuation">)</span></code> <strong>after</strong> using your
                                    factories.</p></div>
                        </blockquote>
                        <h4>Faking A Subset Of Events</h4>
                        <p>If you only want to fake event listeners for a specific set of events, you may pass them to
                            the <code class=" language-php">fake</code> or <code class=" language-php">fakeFor</code>
                            method:</p>
                        <pre class=" language-php"><code class=" language-php"><span class="token comment">/**
 * Test order process.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderProcess</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span
                                    class="token punctuation">(</span><span class="token punctuation">[</span>
        OrderCreated<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

    <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token function">factory</span><span
                                    class="token punctuation">(</span>Order<span class="token punctuation">:</span><span
                                    class="token punctuation">:</span><span class="token keyword">class</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

    Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertDispatched</span><span
                                    class="token punctuation">(</span>OrderCreated<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

    <span class="token comment">// Other events are dispatched as normal...</span>
    <span class="token variable">$order</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">update</span><span
                                    class="token punctuation">(</span><span class="token punctuation">[</span><span
                                    class="token punctuation">.</span><span class="token punctuation">.</span><span
                                    class="token punctuation">.</span><span class="token punctuation">]</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
                        <p><a name="scoped-event-fakes"></a></p>
                        <h3 id="scoped-event-fakes"><a href="#scoped-event-fakes">Scoped Event Fakes</a></h3>
                        <p>If you only want to fake event listeners for a portion of your test, you may use the <code
                                class=" language-php">fakeFor</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span
                                    class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderCreated</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span
                                    class="token punctuation">\</span>Order</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Event</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span
                                    class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Test order process.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderProcess</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$order</span> <span class="token operator">=</span> Event<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fakeFor</span><span class="token punctuation">(</span><span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$order</span> <span class="token operator">=</span> <span
                                    class="token function">factory</span><span
                                    class="token punctuation">(</span>Order<span class="token punctuation">:</span><span
                                    class="token punctuation">:</span><span class="token keyword">class</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">create</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

            Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertDispatched</span><span
                                    class="token punctuation">(</span>OrderCreated<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token variable">$order</span><span
                                    class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Events are dispatched as normal and observers will run ...</span>
        <span class="token variable">$order</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">update</span><span
                                    class="token punctuation">(</span><span class="token punctuation">[</span><span
                                    class="token punctuation">.</span><span class="token punctuation">.</span><span
                                    class="token punctuation">.</span><span class="token punctuation">]</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <p><a name="mail-fake"></a></p>
                        <h2 id="mail-fake"><a href="#mail-fake">Mail Fake</a></h2>
                        <p>You may use the <code class=" language-php">Mail</code> facade's <code class=" language-php">fake</code>
                            method to prevent mail from being sent. You may then assert that <a
                                    href="https://laravel.com/docs/7.x/mail">mailables</a>
                            were sent to users and even inspect the data they received. When using
                            fakes, assertions are made after the code under test is executed:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Mail<span
                                    class="token punctuation">\</span>OrderShipped</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Mail</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span
                                    class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fake</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert that no mailables were sent...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertNothingSent</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertSent</span><span class="token punctuation">(</span>OrderShipped<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$mail</span><span class="token punctuation">)</span> <span
                                    class="token keyword">use</span> <span class="token punctuation">(</span><span
                                    class="token variable">$order</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$mail</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">order</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">id</span> <span
                                    class="token operator">===</span> <span class="token variable">$order</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a message was sent to the given users...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertSent</span><span class="token punctuation">(</span>OrderShipped<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$mail</span><span class="token punctuation">)</span> <span
                                    class="token keyword">use</span> <span class="token punctuation">(</span><span
                                    class="token variable">$user</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$mail</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">hasTo</span><span class="token punctuation">(</span><span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">email</span><span
                                    class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                   <span class="token variable">$mail</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">hasCc</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'...'</span><span
                                    class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                   <span class="token variable">$mail</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">hasBcc</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'...'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a mailable was sent twice...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertSent</span><span class="token punctuation">(</span>OrderShipped<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token number">2</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Assert a mailable was not sent...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertNotSent</span><span class="token punctuation">(</span>AnotherMailable<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <p>If you are queueing mailables for delivery in the background, you should use the <code
                                class=" language-php">assertQueued</code> method instead of <code class=" language-php">assertSent</code>:
                        </p>
                        <pre class=" language-php"><code class=" language-php">Mail<span
                                class="token punctuation">:</span><span class="token punctuation">:</span><span
                                class="token function">assertQueued</span><span class="token punctuation">(</span><span
                                class="token punctuation">.</span><span class="token punctuation">.</span><span
                                class="token punctuation">.</span><span class="token punctuation">)</span><span
                                class="token punctuation">;</span>
Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotQueued</span><span
                                    class="token punctuation">(</span><span class="token punctuation">.</span><span
                                    class="token punctuation">.</span><span class="token punctuation">.</span><span
                                    class="token punctuation">)</span><span
                                    class="token punctuation">;</span></code></pre>
                        <p><a name="notification-fake"></a></p>
                        <h2 id="notification-fake"><a href="#notification-fake">Notification Fake</a></h2>
                        <p>You may use the <code class=" language-php">Notification</code> facade's <code
                                class=" language-php">fake</code> method to prevent notifications from being sent. You
                            may then assert that <a href="https://laravel.com/docs/7.x/notifications">notifications</a>
                            were sent to users and even inspect the data they received. When using
                            fakes, assertions are made after the code under test is executed:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Notifications<span
                                    class="token punctuation">\</span>OrderShipped</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span
                                    class="token punctuation">\</span>AnonymousNotifiable</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Notification</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span
                                    class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fake</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert that no notifications were sent...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertNothingSent</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertSentTo</span><span class="token punctuation">(</span>
            <span class="token variable">$user</span><span class="token punctuation">,</span>
            OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span>
            <span class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$notification</span><span class="token punctuation">,</span> <span
                                    class="token variable">$channels</span><span
                                    class="token punctuation">)</span> <span class="token keyword">use</span> <span
                                    class="token punctuation">(</span><span class="token variable">$order</span><span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$notification</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">order</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">id</span> <span
                                    class="token operator">===</span> <span class="token variable">$order</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">id</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a notification was sent to the given users...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertSentTo</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token variable">$user</span><span
                                    class="token punctuation">]</span><span class="token punctuation">,</span> OrderShipped<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a notification was not sent...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertNotSentTo</span><span
                                    class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token variable">$user</span><span
                                    class="token punctuation">]</span><span class="token punctuation">,</span> AnotherNotification<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a notification was sent via Notification::route() method...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertSentTo</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">AnonymousNotifiable</span><span
                                    class="token punctuation">,</span> OrderShipped<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert Notification::route() method sent notification to the correct user...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertSentTo</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">AnonymousNotifiable</span><span
                                    class="token punctuation">,</span>
            OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span>
            <span class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$notification</span><span class="token punctuation">,</span> <span
                                    class="token variable">$channels</span><span
                                    class="token punctuation">,</span> <span
                                    class="token variable">$notifiable</span><span
                                    class="token punctuation">)</span> <span class="token keyword">use</span> <span
                                    class="token punctuation">(</span><span class="token variable">$user</span><span
                                    class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$notifiable</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">routes</span><span class="token punctuation">[</span><span
                                    class="token single-quoted-string string">'mail'</span><span
                                    class="token punctuation">]</span> <span class="token operator">===</span> <span
                                    class="token variable">$user</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">email</span><span
                                    class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <p><a name="queue-fake"></a></p>
                        <h2 id="queue-fake"><a href="#queue-fake">Queue Fake</a></h2>
                        <p>As an alternative to mocking, you may use the <code class=" language-php">Queue</code>
                            facade's <code class=" language-php">fake</code>
                            method to prevent jobs from being queued. You may then assert that jobs
                            were pushed to the queue and even inspect the data they received. When
                            using fakes, assertions are made after the code under test is executed:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span
                                    class="token punctuation">\</span>AnotherJob</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span
                                    class="token punctuation">\</span>FinalJob</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span
                                    class="token punctuation">\</span>ShipOrder</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Queue</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span
                                    class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fake</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert that no jobs were pushed...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertNothingPushed</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertPushed</span><span class="token punctuation">(</span>ShipOrder<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token keyword">function</span> <span class="token punctuation">(</span><span
                                    class="token variable">$job</span><span class="token punctuation">)</span> <span
                                    class="token keyword">use</span> <span class="token punctuation">(</span><span
                                    class="token variable">$order</span><span class="token punctuation">)</span> <span
                                    class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$job</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">order</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token property">id</span> <span
                                    class="token operator">===</span> <span class="token variable">$order</span><span
                                    class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a job was pushed to a given queue...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertPushedOn</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'queue-name'</span><span
                                    class="token punctuation">,</span> ShipOrder<span class="token punctuation">:</span><span
                                    class="token punctuation">:</span><span class="token keyword">class</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a job was pushed twice...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertPushed</span><span class="token punctuation">(</span>ShipOrder<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token number">2</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Assert a job was not pushed...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertNotPushed</span><span
                                    class="token punctuation">(</span>AnotherJob<span class="token punctuation">:</span><span
                                    class="token punctuation">:</span><span class="token keyword">class</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a job was pushed with a given chain of jobs, matching by class...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertPushedWithChain</span><span
                                    class="token punctuation">(</span>ShipOrder<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token punctuation">[</span>
            AnotherJob<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span>
            FinalJob<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a job was pushed with a given chain of jobs, matching by both class and properties...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertPushedWithChain</span><span
                                    class="token punctuation">(</span>ShipOrder<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">,</span> <span
                                    class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">AnotherJob</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">FinalJob</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'bar'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert a job was pushed without a chain of jobs...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">assertPushedWithoutChain</span><span
                                    class="token punctuation">(</span>ShipOrder<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token keyword">class</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <p><a name="storage-fake"></a></p>
                        <h2 id="storage-fake"><a href="#storage-fake">Storage Fake</a></h2>
                        <p>The <code class=" language-php">Storage</code> facade's <code
                                class=" language-php">fake</code> method allows you to easily generate a fake disk that,
                            combined with the file generation utilities of the <code
                                    class=" language-php">UploadedFile</code> class, greatly simplifies the testing of
                            file uploads. For example:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span
                                    class="token punctuation">\</span>UploadedFile</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Storage</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span
                                    class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testAlbumUpload</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fake</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'photos'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$response</span> <span class="token operator">=</span> <span
                                    class="token variable">$this</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">json</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'POST'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'/photos'</span><span
                                    class="token punctuation">,</span> <span class="token punctuation">[</span>
            UploadedFile<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fake</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">image</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'photo1.jpg'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">,</span>
            UploadedFile<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">fake</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">image</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'photo2.jpg'</span><span
                                    class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Assert one or more files were stored...</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">disk</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'photos'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">assertExists</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'photo1.jpg'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">disk</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'photos'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">assertExists</span><span
                                    class="token punctuation">(</span><span class="token punctuation">[</span><span
                                    class="token single-quoted-string string">'photo1.jpg'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'photo2.jpg'</span><span
                                    class="token punctuation">]</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>

        <span class="token comment">// Assert one or more files were not stored...</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">disk</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'photos'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">assertMissing</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'missing.jpg'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">disk</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'photos'</span><span
                                    class="token punctuation">)</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span
                                    class="token function">assertMissing</span><span
                                    class="token punctuation">(</span><span class="token punctuation">[</span><span
                                    class="token single-quoted-string string">'missing.jpg'</span><span
                                    class="token punctuation">,</span> <span class="token single-quoted-string string">'non-existing.jpg'</span><span
                                    class="token punctuation">]</span><span class="token punctuation">)</span><span
                                    class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon purple"><img src="06-Mocking_files/lightbulb.svg"></div>
                                <p class="content"> By default, the <code class=" language-php">fake</code>
                                    method will delete all files in its temporary directory. If you would
                                    like to keep these files, you may use the "persistentFake" method
                                    instead.</p></div>
                        </blockquote>
                        <p><a name="mocking-facades"></a></p>
                        <h2 id="mocking-facades"><a href="#mocking-facades">Facades</a></h2>
                        <p>Unlike traditional static method calls, <a href="https://laravel.com/docs/7.x/facades">facades</a>
                            may be mocked. This provides a great advantage over traditional static
                            methods and grants you the same testability you would have if you were
                            using dependency injection. When testing, you may often want to mock a
                            call to a Laravel facade in one of your controllers. For example,
                            consider the following controller action:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span
                                    class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Cache</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserController</span> <span
                                    class="token keyword">extends</span> <span
                                    class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Show a list of all users of the application.
     *
     * @return Response
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$value</span> <span class="token operator">=</span> Cache<span
                                    class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">get</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'key'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <p>We can mock the call to the <code class=" language-php">Cache</code> facade by using the
                            <code class=" language-php">shouldReceive</code> method, which will return an instance of a
                            <a href="https://github.com/padraic/mockery">Mockery</a> mock. Since facades are actually
                            resolved and managed by the Laravel <a href="https://laravel.com/docs/7.x/container">service
                                container</a>, they have much more testability than a typical static class. For example,
                            let's mock our call to the <code class=" language-php">Cache</code> facade's <code
                                    class=" language-php">get</code> method:</p>
                        <pre class=" language-php"><code class=" language-php"><span
                                class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span
                                    class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span
                                    class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Cache</span><span
                                    class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span
                                    class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserControllerTest</span> <span
                                    class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testGetIndex</span><span
                                    class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Cache<span class="token punctuation">:</span><span class="token punctuation">:</span><span
                                    class="token function">shouldReceive</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'get'</span><span
                                    class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">once</span><span class="token punctuation">(</span><span
                                    class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">with</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'key'</span><span
                                    class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span
                                    class="token function">andReturn</span><span class="token punctuation">(</span><span
                                    class="token single-quoted-string string">'value'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$response</span> <span class="token operator">=</span> <span
                                    class="token variable">$this</span><span class="token operator">-</span><span
                                    class="token operator">&gt;</span><span class="token function">get</span><span
                                    class="token punctuation">(</span><span class="token single-quoted-string string">'/users'</span><span
                                    class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
                        <blockquote>
                            <div class="callout">
                                <div class="icon red"><img src="06-Mocking_files/exclamation.svg"></div>
                                <p class="content"> You should not mock the <code class=" language-php">Request</code>
                                    facade. Instead, pass the input you desire into the HTTP helper methods such as
                                    <code class=" language-php">get</code> and <code class=" language-php">post</code>
                                    when running your test. Likewise, instead of mocking the <code
                                            class=" language-php">Config</code> facade, call the <code
                                            class=" language-php">Config<span class="token punctuation">:</span><span
                                            class="token punctuation">:</span>set</code> method in your tests.</p></div>
                        </blockquote>
                    </section>
                </section>
            </section>
        </div>
    </div>

</div>

</body>
<script src="../index_files/app.js.download"></script>
</html>